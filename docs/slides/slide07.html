<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>主成分分析</title>
<meta name="author" content="村田 昇"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/oer-reveal.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/plugin/toc-progress/toc-progress.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/toc-style.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/fonts/source-sans-pro/source-sans-pro.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/accessibility/helper.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/mycourse.css"/>
<link rel="stylesheet" href="./reveal.js/plugin/highlight/zenburn.css"/>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-state="no-toc-progress">
<!-- This is an HTML template for the title slide. -->
<!-- Embed logos as necessary. -->
<!-- <a class="nooutlink" href="url"><img class="state-background your-logo-class" src="whatever.png" alt="Whatever" /></a> -->
<div class="talk-title">
    <h1 class="no-toc-progress">主成分分析</h1>
</div>
<div class="talk-subtitle">
    <p>評価と視覚化</p>
</div>
<div class="keyboard-usage">
    <p>(Press <code>?</code> for help, <code>n</code> and <code>p</code> for next and previous slide)</p>
</div>
<div class="talk-author">
  <p>村田 昇<br />
  2020.11.10</p>
</div>

</section>

<section>
<section id="slide-org1547f93">
<h2 id="org1547f93">講義の予定</h2>
<ul>
<li>第1日: 主成分分析の考え方</li>
<li><b>第2日: 分析の評価と視覚化</b></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org890938e">
<h2 id="org890938e">主成分分析の復習</h2>
<div class="outline-text-2" id="text-org890938e">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgb45280f">
<h3 id="orgb45280f">主成分分析</h3>
<ul>
<li>多数の変量のもつ情報の分析・視覚化
<ul>
<li>変量を効率的に縮約して少数の特徴量を構成する</li>
<li>変量の間の関係を明らかにする</li>

</ul></li>
<li>分析の方針:
<ul>
<li>データの情報を最大限保持する変量の線形結合を構成</li>
<li>データの情報を最大限反映する座標(方向)を探索</li>
<li>(データの情報を保持する=データを区別できる)</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgca89033">
<h3 id="orgca89033">分析の考え方</h3>
<ul>
<li>1変量データ
\(\boldsymbol{a}^{\mathsf{T}}\boldsymbol{x}_1,\dotsc,\boldsymbol{a}^{\mathsf{T}}\boldsymbol{x}_n\)
を構成
<ul>
<li>観測データ \(\boldsymbol{x}_1,\dots,\boldsymbol{x}_n\)
のもつ情報を最大限保持するベクトル
\(\boldsymbol{a}\) を <b>うまく</b> 選択</li>
<li>\(\boldsymbol{a}^{\mathsf{T}}\boldsymbol{x}_1,\dotsc,\boldsymbol{a}^{\mathsf{T}}\boldsymbol{x}_n\)
の変動(ばらつき)が最も大きい方向を選択</li>

</ul></li>
<li><p>
<b>最適化問題</b>
</p>
<blockquote>
<p>
制約条件
\(\|\boldsymbol{a}\|=1\)
の下で以下の関数を最大化せよ
</p>
<div>
\begin{equation}
  f(\boldsymbol{a})
  =
  \sum_{i=1}^n(\boldsymbol{a}^{\mathsf{T}}\boldsymbol{x}_i
  -\boldsymbol{a}^{\mathsf{T}}\bar{\boldsymbol{x}})^2,
  \quad
  \bar{\boldsymbol{x}}
  =
  \frac{1}{n}\sum_{i=1}^n\boldsymbol{x}_i
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org915ea6a">
<h3 id="org915ea6a">行列による表現</h3>
<ul>
<li><p>
中心化したデータ行列
</p>
<blockquote>
<div>
\begin{equation}
  X
  =
  \begin{pmatrix}
    \boldsymbol{x}_{1}^{\mathsf{T}}-\bar{\boldsymbol{x}}^{\mathsf{T}} \\
    \vdots \\
    \boldsymbol{x}_{n}^{\mathsf{T}}-\bar{\boldsymbol{x}}^{\mathsf{T}}
  \end{pmatrix}
  =
  \begin{pmatrix}
    x_{11}-\bar{x}_1 & \cdots & x_{1p}-\bar{x}_p\\
    \vdots & & \vdots \\
    x_{n1}-\bar{x}_1 & \cdots & x_{np}-\bar{x}_p
  \end{pmatrix}
\end{equation}

</div>
</blockquote></li>
<li><p>
評価関数 \(f(\boldsymbol{a})\) は行列 \(X^{\mathsf{T}}X\) 
の二次形式
</p>
<blockquote>
<div>
\begin{equation}
  f(\boldsymbol{a})
  =
  \boldsymbol{a}^{\mathsf{T}}X^{\mathsf{T}}X\boldsymbol{a}
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org360975a">
<h3 id="org360975a">固有値問題</h3>
<ul>
<li><p>
最適化問題
</p>
<blockquote>
<div>
\begin{equation}
  \text{maximize}\quad
  f(\boldsymbol{a})
  =
  \boldsymbol{a}^{\mathsf{T}}X^{\mathsf{T}}X\boldsymbol{a}
  \quad\text{s.t.}\quad
  \boldsymbol{a}^{\mathsf{T}}\boldsymbol{a}=1
\end{equation}

</div>
</blockquote></li>
<li><p>
解の条件
</p>
<blockquote>
<p>
\(f(\boldsymbol{a})\) の極大値を与える \(\boldsymbol{a}\) は
\(X^{\mathsf{T}}X\) の固有ベクトルである
</p>
<div>
\begin{equation}
  X^{\mathsf{T}}X\boldsymbol{a}
  =
  \lambda\boldsymbol{a}
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org3d0c4c7">
<h3 id="org3d0c4c7">主成分負荷量と主成分得点</h3>
<ul>
<li>\(\boldsymbol{a}\):
<b>主成分負荷量</b> (principal component loading)</li>
<li>\(\boldsymbol{a}^{\mathsf{T}}\boldsymbol{x}_i\):
<b>主成分得点</b> (principal component score)</li>
<li><p>
第1主成分負荷量
</p>
<blockquote>
<p>
\(X^{\mathsf{T}}X\) の第1(最大)固有値 \(\lambda_1\)
に対応する固有ベクトル \(\boldsymbol{a}_1\)
</p>
</blockquote></li>
<li><p>
第\(k\)主成分負荷量
</p>
<blockquote>
<p>
\(X^{\mathsf{T}}X\) の第 \(k\) 固有値 \(\lambda_k\)
に対応する固有ベクトル \(\boldsymbol{a}_k\)
</p>
</blockquote></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orga2ad3b7" data-background="#fef4f4">
<h2 id="orga2ad3b7">演習</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org0dc4b96" data-background="#fef4f4">
<h3 id="org0dc4b96">問題</h3>
<ul>
<li>以下の問に答えなさい．
<ul>
<li><p>
ベクトル\(\boldsymbol{a}\)
を
\(X^{\mathsf{T}}X\)
の単位固有ベクトルとするとき
</p>
<blockquote>
<div>
\begin{equation}
  f(\boldsymbol{a})=\boldsymbol{a}^{\mathsf{T}}X^{\mathsf{T}}X\boldsymbol{a}
\end{equation}

</div>
</blockquote>
<p>
の値を求めよ．
</p></li>
<li><p>
行列\(X\)を中心化したデータ行列，
ベクトル\(\boldsymbol{a}_{k}\)を第\(k\)主成分負荷量とする．
第\(k\)主成分得点の平均まわりの平方和
</p>
<blockquote>
<div>
\begin{equation}
  \sum_{i=1}^n(\boldsymbol{a}_{k}^{\mathsf{T}}\boldsymbol{x}_i
  -\boldsymbol{a}_{k}^{\mathsf{T}}\bar{\boldsymbol{x}})^2
\end{equation}

</div>
</blockquote>
<p>
を
\(X\)と\(\boldsymbol{a}_{k}\)で表せ．
</p></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org86ca847" data-background="#fef4f4">
<h3 id="org86ca847">解答例</h3>
<ul>
<li><p>
固有値・固有ベクトルの性質を利用する
</p>
<blockquote>
<p>
\(X^{\mathsf{T}}X\)の
固有値・固有ベクトルを
\(\lambda_{k}, \boldsymbol{a}_{k}\)
とする．
\(\boldsymbol{a}=\boldsymbol{a}_{k}\)とすれば
</p>
<div>
\begin{align}
  f(\boldsymbol{a}_{k})
  &=\boldsymbol{a}_{k}^{\mathsf{T}}X^{\mathsf{T}}X\boldsymbol{a}_{k}\\
  &=\boldsymbol{a}_{k}^{\mathsf{T}}\lambda_{k}\boldsymbol{a}_{k}
  &&\text{(固有ベクトル)}\\
  &=\lambda_{k}
  &&\text{(単位ベクトル)}
\end{align}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section data-background="#fef4f4">
<ul>
<li><p>
定義に従い計算すればよい(前回の復習)
</p>
<blockquote>
<div>
\begin{align}
  f(\boldsymbol{a}_{k})
  &=
    \sum_{i=1}^{n}(\boldsymbol{a}_{k}^{\mathsf{T}}\boldsymbol{x}_i
    -\boldsymbol{a}_{k}^{\mathsf{T}}\bar{\boldsymbol{x}})^2\\
  &=
    \sum_{i=1}^{n}
    (X\boldsymbol{a}_{k})_{i}^{2}\\
  &=
    \sum_{i=1}^{n}
    (X\boldsymbol{a}_{k})_{i}
    (X\boldsymbol{a}_{k})_{i}\\
  &=
    (\boldsymbol{a}_{k}^{\mathsf{T}}X^{\mathsf{T}})
    (X\boldsymbol{a}_{k})
    =
    \boldsymbol{a}_{k}^{\mathsf{T}}X^{\mathsf{T}}X\boldsymbol{a}_{k}
\end{align}

</div>
</blockquote></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orgb172528">
<h2 id="orgb172528">寄与率</h2>
<div class="outline-text-2" id="text-orgb172528">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgf5c65aa">
<h3 id="orgf5c65aa">寄与率の考え方</h3>
<ul>
<li><p>
回帰分析で考察した <b>寄与率</b> の一般形
</p>
<blockquote>
<div>
\begin{equation}
  \text{(寄与率)}=
  \frac{\text{(その方法で説明できる変動)}}{\text{(データ全体の変動)}}
\end{equation}

</div>
</blockquote></li>
<li><p>
主成分分析での定義 (proportion of variance)
</p>
<blockquote>
<div>
\begin{equation}
  \text{(寄与率)}=
  \frac{\text{(主成分の変動)}}{\text{(全体の変動)}}
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgef725e1">
<h3 id="orgef725e1">Gram行列のスペクトル分解</h3>
<ul>
<li><p>
行列 \(X^{\mathsf{T}}X\) (非負値正定対称行列) のスペクトル分解
</p>
<blockquote>
<div>
\begin{equation}
  X^{\mathsf{T}}X
  =\sum_{k=1}^{p}\lambda_{k}\boldsymbol{a}_{k}\boldsymbol{a}_{k}^{\mathsf{T}}
\end{equation}

</div>

<p>
固有値と固有ベクトルによる行列の表現
</p>
</blockquote></li>
<li><p>
主成分の変動の評価
</p>
<blockquote>
<div>
\begin{equation}
  f(\boldsymbol{a}_{k})
  =
  \boldsymbol{a}_{k}^{\mathsf{T}}X^{\mathsf{T}}X\boldsymbol{a}_{k}
  =\lambda_{k}
\end{equation}

</div>

<p>
固有ベクトル(単位ベクトル)の直交性を利用
</p>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org8905d1a">
<h3 id="org8905d1a">寄与率の計算</h3>
<ul>
<li><p>
主成分と全体の変動
</p>
<blockquote>
<div>
\begin{align}
  \text{(主成分の変動)}
  &=
    \sum_{i=1}^{n}(\boldsymbol{a}_k^{\mathsf{T}}\boldsymbol{x}_i
    -\boldsymbol{a}_k^{\mathsf{T}}\bar{\boldsymbol{x}})^2
    =\boldsymbol{a}_{k}^{\mathsf{T}}X^{\mathsf{T}}X\boldsymbol{a}_{k}
    =\lambda_k\\
  \text{(全体の変動)}
  &=
    \sum_{i=1}^{n}\|\boldsymbol{x}_i-\bar{\boldsymbol{x}}\|^2
    =\sum_{l=1}^p\boldsymbol{a}_{l}^{\mathsf{T}}X^{\mathsf{T}}X\boldsymbol{a}_{l}
    =\sum_{l=1}^p\lambda_l
\end{align}

</div>
</blockquote></li>
<li><p>
寄与率の固有値による表現:
</p>
<blockquote>
<div>
\begin{equation}
  \text{(寄与率)}
  =
  \frac{\lambda_k}{\sum_{l=1}^p\lambda_l}  
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org0bf0c56">
<h3 id="org0bf0c56">累積寄与率</h3>
<ul>
<li><p>
<b>累積寄与率</b> (cumulative proportion) :
第 \(k\) 主成分までの変動の累計
</p>
<blockquote>
<div>
\begin{equation}
  \text{(累積寄与率)}
  =
  \frac{\sum_{l=1}^k\lambda_l}{\sum_{l=1}^p\lambda_l}
\end{equation}

</div>

<p>
第1から第 \(k\) までの寄与率の総和
</p>
</blockquote>
<ul>
<li>累積寄与率はいくつの主成分を用いるべきかの基準</li>
<li>一般に累積寄与率が80%程度までの主成分を用いる</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orgc25a28e">
<h2 id="orgc25a28e">解析の事例</h2>
<div class="outline-text-2" id="text-orgc25a28e">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgcb2a30f">
<h3 id="orgcb2a30f">データセット</h3>
<ul>
<li>総務省統計局より取得した都道府県別の社会生活統計指標の一部
<ul>
<li><p>
総務省 <a href="https://www.e-stat.go.jp/SG1/estat/List.do?bid=000001083999&amp;cycode=0">https://www.e-stat.go.jp/SG1/estat/List.do?bid=000001083999&amp;cycode=0</a>
</p>
<blockquote>
<ul>
<li>Pref: 都道府県名</li>
<li>Forest: 森林面積割合 (%) 2014年</li>
<li>Agri: 就業者１人当たり農業産出額(販売農家）(万円) 2014年</li>
<li>Ratio: 全国総人口に占める人口割合 (%) 2015年</li>
<li>Land: 土地生産性（耕地面積１ヘクタール当たり）(万円) 2014年</li>
<li>Goods: 商業年間商品販売額［卸売業＋小売業］（事業所当たり）(百万円) 2013年</li>

</ul>
</blockquote></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>データの一部</li>

</ul>
<pre class="example">
	  Forest   Agri Ratio  Land  Goods
Hokkaido    67.9 1150.6  4.23  96.8  283.3
Aomori      63.8  444.7  1.03 186.0  183.0
Iwate       74.9  334.3  1.01 155.2  179.4
Miyagi      55.9  299.9  1.84 125.3  365.9
Akita       70.5  268.7  0.81  98.5  153.3
Yamagata    68.7  396.3  0.88 174.1  157.5
Fukushima   67.9  236.4  1.51 127.1  184.5
Ibaraki     31.0  479.0  2.30 249.1  204.9
Tochigi     53.2  402.6  1.55 199.6  204.3
Gumma       63.8  530.6  1.55 321.6  270.0
Saitama     31.9  324.7  5.72 247.0  244.7
Chiba       30.4  565.5  4.90 326.1  219.7
Tokyo       34.8  268.5 10.63 404.7 1062.6
Kanagawa    38.8  322.8  7.18 396.4  246.1
Niigata     63.5  308.6  1.81 141.9  205.5
Toyama      56.6  276.1  0.84  98.5  192.4
Ishikawa    66.0  271.3  0.91 112.0  222.9
Fukui       73.9  216.1  0.62  98.5  167.3
</pre>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org4949c6a">
<h3 id="org4949c6a">各変数の分布</h3>
<ul>
<li>変数のばらつきに大きな違いがある</li>

</ul>

<div id="orgecd650e" class="figure">
<p><img src="figs/07_boxplot.png" alt="07_boxplot.png" />
</p>
<p><span class="figure-number">Figure 1: </span>各変数の箱ひげ図</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgb80651d">
<h3 id="orgb80651d">データの正規化</h3>
<ul>
<li>各変数の標本平均を0，不偏分散を1に規格化する</li>

</ul>

<div id="org0c79ff5" class="figure">
<p><img src="figs/07_pairs.png" alt="07_pairs.png" />
</p>
<p><span class="figure-number">Figure 2: </span>正規化したデータの散布図</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org35f7cd7">
<h3 id="org35f7cd7">主成分分析</h3>
<ul>
<li><p>
主成分負荷量
</p>
<pre class="example">
              PC1        PC2         PC3        PC4         PC5
Forest -0.4871498  0.1045813 -0.45748795  0.6859649 -0.26815060
Agri    0.1339190  0.8115056  0.47912767  0.3045447  0.03483694
Ratio   0.5851294 -0.1511042  0.04467249  0.1640953 -0.77837539
Land    0.3547649  0.4851374 -0.74167904 -0.2897485  0.06885892
Goods   0.5258481 -0.2689436 -0.09517368  0.5708093  0.56238052
</pre>


<ul>
<li>第1: 人の多さに関する成分(正の向きほど人が多い)</li>
<li>第2: 農業生産力に関する成分(正の向きほど高い)</li>

</ul></li>
<li><p>
寄与率
</p>
<pre class="example">
Importance of components:
                          PC1    PC2    PC3    PC4     PC5
Standard deviation     1.5904 1.0699 0.8196 0.7076 0.39190
Proportion of Variance 0.5059 0.2289 0.1343 0.1001 0.03072
Cumulative Proportion  0.5059 0.7348 0.8691 0.9693 1.00000
</pre></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>第1,2主成分得点の表示</li>

</ul>

<div id="org849a451" class="figure">
<p><img src="figs/07_pcaplot12.png" alt="07_pcaplot12.png" />
</p>
<p><span class="figure-number">Figure 3: </span>主成分得点による散布図</p>
</div>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>第3,2主成分得点の表示</li>

</ul>

<div id="orgf5d642f" class="figure">
<p><img src="figs/07_pcaplot32.png" alt="07_pcaplot32.png" />
</p>
<p><span class="figure-number">Figure 4: </span>主成分得点による散布図</p>
</div>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orgcda8e18" data-background="#fef4f4">
<h2 id="orgcda8e18">演習</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orga7f0a23" data-background="#fef4f4">
<h3 id="orga7f0a23">問題</h3>
<ul>
<li>以下の問に答えなさい．
<ul>
<li><p>
正規化条件を満たす線形変換
\(x'_{ij}=a_{j}(x_{ij}-b_{j})\)
を求めよ．
</p>
<blockquote>
<div>
\begin{equation}
  \frac{1}{n}\sum_{i=1}^{n}x'_{ij}=0,\quad
  \frac{1}{n-1}\sum_{i=1}^{n}(x'_{ij})^{2}=1
\end{equation}

</div>
</blockquote></li>
<li><p>
正規化されたデータ行列を
</p>
<blockquote>
<div>
\begin{equation}
  X'
  =
  \begin{pmatrix}
    {\boldsymbol{x}'_{1}}^{\mathsf{T}}\\
    \vdots \\
    {\boldsymbol{x}'_{n}}^{\mathsf{T}}
  \end{pmatrix}
  =
  \begin{pmatrix}
    x'_{11} & \cdots & x'_{1p}\\
    \vdots & & \vdots \\
    x'_{n1} & \cdots & x'_{np}
  \end{pmatrix}
\end{equation}

</div>
</blockquote>
<p>
と書くとき，\(X'^{\mathsf{T}}X'\)の対角成分を求めよ．
</p></li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgc68a8db" data-background="#fef4f4">
<h3 id="orgc68a8db">解答例</h3>
<ul>
<li><p>
標本平均の定義どおりに計算すればよい
</p>
<blockquote>
<div>
\begin{align}
  \frac{1}{n}\sum_{i=1}^{n}x'_{ij}
  &=
  \frac{1}{n}\sum_{i=1}^{n}\left(a_{j}(x_{ij}-b_{j})\right)\\
  &=
    a_{j}\left(\frac{1}{n}\sum_{i=1}^{n}x_{ij}-b_{j}\right)\\
  &=0
\end{align}

</div>

<p>
したがって
</p>
<div>
\begin{equation}
  b_{j}
  =
  \frac{1}{n}\sum_{i=1}^{n}x_{ij}
  =\bar{x}_{j}
  \quad\text{(元の変数の標本平均)}
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section data-background="#fef4f4">
<ul>
<li><p>
不偏分散も同様に計算すればよい
</p>
<blockquote>
<div>
\begin{align}
  \frac{1}{n-1}\sum_{i=1}^{n}(x'_{ij})^{2}
  &=
  a_{j}^{2}\frac{1}{n-1}\sum_{i=1}^{n}(x_{ij}-\bar{x}_{j})^{2}\\
  &=1
\end{align}

</div>

<p>
したがって
</p>
<div>
\begin{equation}
  a_{j}
  =
  \left(\frac{1}{n-1}\sum_{i=1}^{n}(x_{ij}-\bar{x}_{j})^{2}\right)^{-1/2}
  \quad\text{(標準偏差の逆数)}
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section data-background="#fef4f4">
<ul>
<li><p>
不偏分散であることに注意する
</p>
<blockquote>
<div>
\begin{equation}
  (X'^{\mathsf{T}}X')_{jj}
  =
  \sum_{i=1}^{n}(x'_{ij})^{2}
  =
  n-1
\end{equation}

</div>
</blockquote></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org4e347c9">
<h2 id="org4e347c9">主成分負荷量</h2>
<div class="outline-text-2" id="text-org4e347c9">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgf8834de">
<h3 id="orgf8834de">主成分負荷量と主成分得点</h3>
<ul>
<li>負荷量(得点係数)の大きさ: 変数の貢献度</li>
<li><b>問題点</b>:
<ul>
<li>変数のスケールによって係数の大きさは変化する</li>
<li>変数の正規化(平均0，分散1)がいつも妥当とは限らない</li>

</ul></li>
<li>スケールによらない変数と主成分の関係: <br />
<b>相関係数</b> を考えればよい</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org20db5f3">
<h3 id="org20db5f3">相関係数</h3>
<ul>
<li>\(\boldsymbol{e}_{j}\): 第 \(j\) 成分は1，それ以外は0のベクトル</li>
<li>\(X\boldsymbol{e}_{j}\): 第 \(j\) 変数ベクトル</li>
<li>\(X\boldsymbol{a}_{k}\): 第 \(k\) 主成分得点ベクトル</li>
<li><p>
主成分と変数の相関係数:
</p>
<blockquote>
<div>
\begin{align}
  \mathrm{Cor}(X\boldsymbol{a}_{k},X\boldsymbol{e}_{j})
  % &=\frac{(X\boldsymbol{a}_{k})^{\mathsf{T}}X\boldsymbol{e}_{l}}
  % {\sqrt{(X\boldsymbol{a}_{k})^{\mathsf{T}}X\boldsymbol{a}_{k}}
  % \sqrt{(X\boldsymbol{e}_{l})^{\mathsf{T}}X\boldsymbol{e}_{l}}}\\
    &=\frac{\boldsymbol{a}_{k}^{\mathsf{T}}X^{\mathsf{T}}X\boldsymbol{e}_{j}}
      {\sqrt{\boldsymbol{a}_{k}^{\mathsf{T}}X^{\mathsf{T}}X\boldsymbol{a}_{k}}
      \sqrt{\boldsymbol{e}_{j}^{\mathsf{T}}X^{\mathsf{T}}X\boldsymbol{e}_{j}}}\\
    &=\frac{\lambda_{k}\boldsymbol{a}_{k}^{\mathsf{T}}\boldsymbol{e}_{j}}
      {\sqrt{\lambda_{k}}\sqrt{(X^{\mathsf{T}}X)_{jj}}}
\end{align}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org2ebaea1">
<h3 id="org2ebaea1">正規化データの場合</h3>
<ul>
<li>\(X^{\mathsf{T}}X\) の対角成分は全て\(n-1\)
(\((X^{\mathsf{T}}X)_{jj}=n-1\))</li>

</ul>

<ul>
<li><p>
第 \(k\) 主成分に対する相関係数ベクトル:
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{r}_{k}
  =\sqrt{\lambda_{k}/(n-1)}\cdot\boldsymbol{a}_{k},
  \quad
  (\boldsymbol{r}_{k})_{j}
  =\sqrt{\lambda_{k}/(n-1)}\cdot(\boldsymbol{a}_{k})_{j}
\end{equation}

</div>
</blockquote></li>
<li><b>主成分負荷量</b>
<ul>
<li>同じ主成分への各変数の影響は固有ベクトルの成分比</li>
<li>同じ変数の各主成分への影響は固有値の平方根で重みづけ</li>

</ul></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org9a92855">
<h2 id="org9a92855">データ行列の分解表現</h2>
<div class="outline-text-2" id="text-org9a92855">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org8ec2614">
<h3 id="org8ec2614">特異値分解</h3>
<ul>
<li><p>
階数 \(r\) の \(n\times p\) 型行列 \(X\) の分解:
</p>
<blockquote>
<div>
\begin{equation}
  X=U\Sigma V^{\mathsf{T}}
\end{equation}

</div>
</blockquote>
<ul>
<li>\(U\) は \(n\times n\) 型直交行列, \(V\) は \(p\times p\) 型直交行列</li>
<li><p>
\(\Sigma\) は \(n\times p\) 型行列
</p>
<blockquote>
<div>
\begin{equation}
  \Sigma
  =
  \begin{pmatrix}
    D & O_{r,p-r}\\
    O_{n-r,r} & O_{n-r,m-r}
  \end{pmatrix}
\end{equation}

</div>
</blockquote>
<ul>
<li>\(O_{s,t}\) は \(s\times t\) 型零行列</li>
<li>\(D\) は \(\sigma_{1}\geq\sigma_{2}\geq\sigma_{r}>0\) 
を対角成分とする \(r\times r\) 型対角行列</li>

</ul></li>

</ul></li>

</ul>


<div class="slide-footer"><br></div>
</section>
<section id="slide-org49dd8b6">
<h3 id="org49dd8b6">特異値</h3>
<ul>
<li><p>
行列 \(\Sigma\) の成分表示
</p>
<blockquote>
<div>
\begin{equation}
  \Sigma
  =
  \begin{pmatrix}
    \sigma_{1}&&&\\
    &\ddots&&O_{r,p-r}\\
    &&\sigma_{r}&\\
    &&&\\
    &O_{n-r,r} && O_{n-r,m-r}
  \end{pmatrix}
\end{equation}

</div>
</blockquote></li>
<li>\(D\) の対角成分: \(X\) の <b>特異値</b> (singular value)</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orga141820">
<h3 id="orga141820">特異値分解によるGram行列の表現</h3>
<ul>
<li><p>
Gram行列の展開:
</p>
<blockquote>
<div>
\begin{align*}
  X^{\mathsf{T}}X
  &=(U\Sigma V^{\mathsf{T}})^{\mathsf{T}}(U\Sigma V^{\mathsf{T}})\\
  &=V\Sigma^{\mathsf{T}}U^{\mathsf{T}}U\Sigma V^{\mathsf{T}}\\
  &=V\Sigma^{\mathsf{T}}\Sigma V^{\mathsf{T}}
\end{align*}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
行列 \(\Sigma^{\mathsf{T}}\Sigma\) は対角行列
</p>
<blockquote>
<div>
\begin{equation}
  \Sigma^{\mathsf{T}}\Sigma
  =
  \begin{pmatrix}
    \sigma_{1}^{2}&&&&&\\
    &\ddots&&&&\\
    &&\sigma_{r}^{2}&&&\\
    &&&0&&\\
    &&&&\ddots&\\
    &&&&&0
  \end{pmatrix}
\end{equation}

</div>
</blockquote></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org1a87367" data-background="#fef4f4">
<h2 id="org1a87367">演習</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org6594aa6" data-background="#fef4f4">
<h3 id="org6594aa6">問題</h3>
<ul>
<li>行列\(X\)の特異値分解を\(U\Sigma V^{\mathsf{T}}\)とし，
行列\(U\)の第\(k\)列ベクトルを\(\boldsymbol{u}_{k}\)，
行列\(V\)の第\(k\)列ベクトルを\(\boldsymbol{v}_{k}\)
とする．
以下の問に答えなさい．
<ul>
<li>行列\(U,V\)の列ベクトルを用いて\(X\)を展開しなさい</li>
<li>Gram行列\(X^{\mathsf{T}}X\)の固有値を特異値で表しなさい．</li>
<li>行列\(X\)の主成分負荷量を求めなさい．</li>
<li>それぞれの負荷量に対応する主成分得点を求めなさい．</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org7bcb793" data-background="#fef4f4">
<h3 id="org7bcb793">解答例</h3>
<ul>
<li><p>
\(\Sigma\)が対角成分しか持たないことに注意すると
以下のように展開される
</p>
<blockquote>
<div>
\begin{equation}
  X
  =
  U\Sigma V^{\mathsf{T}}
  =
  \sum_{k=1}^{r}\sigma_{k}\boldsymbol{u}_{k}\boldsymbol{v}_{k}^{\mathsf{T}}
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section data-background="#fef4f4">
<ul>
<li><p>
先週の演習問題と特異値分解を比較する
</p>
<blockquote>
<div>
\begin{equation}
  X^{\mathsf{T}}X
  =
  V\Sigma^{\mathsf{T}}\Sigma V^{\mathsf{T}}
  =
  A^{\mathsf{T}}\Lambda A
\end{equation}

</div>

<p>
より
</p>
<div>
\begin{equation}
  \lambda_{k}
  =
  \begin{cases}
    \sigma_{k}^{2},&k\leq r\\
    0,&k>r
  \end{cases}
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section data-background="#fef4f4">
<ul>
<li><p>
転置に気をつけて同様に比較すればよい
</p>
<blockquote>
<div>
\begin{equation}
  A
  =
  \begin{pmatrix}
    \boldsymbol{a}_{1}^{\mathsf{T}}\\
    \vdots \\
    \boldsymbol{a}_{p}^{\mathsf{T}}
  \end{pmatrix}
\end{equation}

</div>

<p>
と定義されているので
主成分負荷量(固有ベクトル)は行列 \(V\) の列ベクトル
</p>
<div>
\begin{equation}
  \boldsymbol{a}_{k}=\boldsymbol{v}_{k}
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section data-background="#fef4f4">
<ul>
<li><p>
主成分得点の定義どおり計算する
</p>
<blockquote>
<div>
\begin{equation}
  X\boldsymbol{a}_{k}
  =
  U\Sigma V^{\mathsf{T}}\boldsymbol{v}_{k}
  =\sigma_{k}\boldsymbol{u}_{k}
\end{equation}

</div>

<p>
ただし\(k>r\)のとき\(\sigma_{k}=0\)とする
</p>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org897bc82">
<h2 id="org897bc82">バイプロット</h2>
<div class="outline-text-2" id="text-org897bc82">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgc7a6c22">
<h3 id="orgc7a6c22">データ行列の分解</h3>
<ul>
<li>行列 \(U\) の第 \(k\) 列ベクトル \(\boldsymbol{u}_{k}\)</li>
<li>行列 \(V\) の第 \(k\) 列ベクトル \(\boldsymbol{v}_{k}\)</li>
<li><p>
データ行列の特異値分解: (<b>注意</b> \(\Sigma\) は対角行列)
</p>
<blockquote>
<div>
\begin{equation}
  X
  =
  U\Sigma V^{\mathsf{T}}
  =
  \sum_{k=1}^{r}\sigma_{k}\boldsymbol{u}_{k}\boldsymbol{v}_{k}^{\mathsf{T}}
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org58a4679">
<h3 id="org58a4679">データ行列の近似表現</h3>
<ul>
<li><p>
第 \(k\) 主成分と第 \(l\) 主成分を用いた行列 \(X\) の近似 \(X'\)
</p>
<blockquote>
<div>
\begin{equation}
  X\simeq X'
  =\sigma_{k}\boldsymbol{u}_{k}\boldsymbol{v}_{k}^{\mathsf{T}}
  +\sigma_{l}\boldsymbol{u}_{l}\boldsymbol{v}_{l}^{\mathsf{T}}
\end{equation}

</div>
</blockquote></li>
<li><p>
行列の積による表現
</p>
<blockquote>
<div>
\begin{align}
  X'&=GH^{\mathsf{T}},\\
  &G=
  \begin{pmatrix}
    \sigma_{k}^{1-s}\boldsymbol{u}_{k}&
    \sigma_{l}^{1-s}\boldsymbol{u}_{l}
  \end{pmatrix}
  ,\quad
  H=
  \begin{pmatrix}
    \sigma_{k}^{s}\boldsymbol{v}_{k}&
    \sigma_{l}^{s}\boldsymbol{v}_{l}
  \end{pmatrix}
  \quad
  (0\leq s\leq1)
\end{align}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org5f5e590">
<h3 id="org5f5e590">バイプロット</h3>
<ul>
<li>関連がある2枚の散布図を1つの画面に表示する散布図を一般に
<b>バイプロット</b> (biplot) と呼ぶ</li>
<li><p>
行列\(G,H\)の各行を2次元座標と見なす
</p>
<blockquote>
<div>
\begin{equation}
  X'=GH^{\mathsf{T}}
\end{equation}

</div>
</blockquote>
<ul>
<li>行列 \(G\) の各行は各データの2次元座標</li>
<li>行列 \(H\) の各行は各変量の2次元座標</li>

</ul></li>
<li>パラメタ \(s\) は \(0\), \(1\) または \(1/2\) が主に用いられる</li>
<li>\(X\) の変動を最大限保持する近似は \(k=1,l=2\)</li>

</ul>

<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org7e63985">
<h2 id="org7e63985">解析の事例</h2>
<div class="outline-text-2" id="text-org7e63985">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org7d60c00">
<h3 id="org7d60c00">バイプロット</h3>
<ul>
<li><p>
主成分負荷量
</p>
<pre class="example">
              PC1        PC2         PC3        PC4         PC5
Forest -0.4871498  0.1045813 -0.45748795  0.6859649 -0.26815060
Agri    0.1339190  0.8115056  0.47912767  0.3045447  0.03483694
Ratio   0.5851294 -0.1511042  0.04467249  0.1640953 -0.77837539
Land    0.3547649  0.4851374 -0.74167904 -0.2897485  0.06885892
Goods   0.5258481 -0.2689436 -0.09517368  0.5708093  0.56238052
</pre></li>

<li><p>
寄与率
</p>
<pre class="example">
Importance of components:
                          PC1    PC2    PC3    PC4     PC5
Standard deviation     1.5904 1.0699 0.8196 0.7076 0.39190
Proportion of Variance 0.5059 0.2289 0.1343 0.1001 0.03072
Cumulative Proportion  0.5059 0.7348 0.8691 0.9693 1.00000
</pre></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>第1,2主成分によるバイプロット</li>

</ul>

<div id="orgd0dcc54" class="figure">
<p><img src="figs/07_biplot12.png" alt="07_biplot12.png" />
</p>
<p><span class="figure-number">Figure 5: </span>主成分分析のバイプロット(第1,2)</p>
</div>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>第3,2主成分によるバイプロット</li>

</ul>

<div id="orgeb3ec7b" class="figure">
<p><img src="figs/07_biplot32.png" alt="07_biplot32.png" />
</p>
<p><span class="figure-number">Figure 6: </span>主成分分析のバイプロット(第3,2)</p>
</div>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>中心部の拡大 (第1,2主成分)</li>

</ul>

<div id="org0ec9210" class="figure">
<p><img src="figs/07_biplot12e.png" alt="07_biplot12e.png" />
</p>
<p><span class="figure-number">Figure 7: </span>主成分分析のバイプロット(第1,2)</p>
</div>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>中心部の拡大 (第3,2主成分)</li>

</ul>

<div id="orgae98242" class="figure">
<p><img src="figs/07_biplot32e.png" alt="07_biplot32e.png" />
</p>
<p><span class="figure-number">Figure 8: </span>主成分分析のバイプロット(第3,2)</p>
</div>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org7b47a02">
<h2 id="org7b47a02">次週の予定</h2>
<ul>
<li><b>第1日: 判別分析の考え方</b></li>
<li>第2日: 分析の評価</li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>
<script src="./reveal.js/plugin/search/search.js"></script>
<script src="./reveal.js/plugin/zoom/zoom.js"></script>
<script src="./reveal.js/plugin/highlight/highlight.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: true,
hashOneBasedIndex: false,
pdfSeparateFragments: false,

overview: true,

transition: 'fade',
transitionSpeed: 'default',
spotlight: { size: 90, initialPresentationMode: false }, chalkboard: { toggleChalkboardButton: { left: '80px' }, toggleNotesButton: { left: '130px'}}, keyboard: { 69: function() { RevealChalkboard.toggleNotesCanvas() }, 87: function() { RevealChalkboard.toggleChalkboard() }, 67: function() { RevealChalkboard.clear() }, 82: function() { RevealChalkboard.reset() }, 68: function() { RevealChalkboard.download() }, 88: function() { RevealChalkboard.colorNext() }, 89: function() { RevealChalkboard.colorPrev() }, 84: function() { RevealSpotlight.toggleSpotlight() }, 81: function() { RevealSpotlight.togglePresentationMode()}},

// Plugins with reveal.js 4.x
plugins: [ RevealNotes, RevealSearch, RevealZoom, RevealHighlight ],

// Optional libraries used to extend reveal.js
dependencies: [
{ src: './reveal.js/plugin/menu/menu.js'},
{ src: './reveal.js/plugin/chalkboard/chalkboard.js'},
{ src: './reveal.js/plugin/spotlight/spotlight.js'}]

});
</script>
</body>
</html>
