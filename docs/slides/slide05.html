<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>回帰分析</title>
<meta name="author" content="村田 昇"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/oer-reveal.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/plugin/toc-progress/toc-progress.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/toc-style.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/fonts/source-sans-pro/source-sans-pro.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/accessibility/helper.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/mycourse.css"/>
<link rel="stylesheet" href="./reveal.js/plugin/highlight/zenburn.css"/>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-state="no-toc-progress">
<!-- This is an HTML template for the title slide. -->
<!-- Embed logos as necessary. -->
<!-- <a class="nooutlink" href="url"><img class="state-background your-logo-class" src="whatever.png" alt="Whatever" /></a> -->
<div class="talk-title">
    <h1 class="no-toc-progress">回帰分析</h1>
</div>
<div class="talk-subtitle">
    <p>予測と発展的なモデル</p>
</div>
<div class="keyboard-usage">
    <p>(Press <code>?</code> for help, <code>n</code> and <code>p</code> for next and previous slide)</p>
</div>
<div class="talk-author">
  <p>村田 昇<br />
  2020.10.27</p>
</div>

</section>
<section>
<section id="slide-orgd1d6252">
<h2 id="orgd1d6252">講義の予定</h2>
<ul>
<li>第1日: 回帰モデルの考え方と推定</li>
<li>第2日: モデルの評価</li>
<li><b>第3日: モデルによる予測と発展的なモデル</b></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orgeef66af">
<h2 id="orgeef66af">回帰分析の復習</h2>
<div class="outline-text-2" id="text-orgeef66af">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org857d9cb">
<h3 id="org857d9cb">線形回帰モデル</h3>
<ul>
<li><b>目的変数</b> を <b>説明変数</b> で説明する関係式を構成:
<ul>
<li>説明変数: \(x_1,\dotsc,x_p\) (p次元)</li>
<li>目的変数: \(y\) (1次元)</li>

</ul></li>
<li><p>
<b>回帰係数</b> \(\beta_0,\beta_1,\dotsc,\beta_p\) を用いた一次式:
</p>
<blockquote>
<div>
\begin{equation}
  y=\beta_0+\beta_1x_1+\dotsb+\beta_px_p
\end{equation}

</div>
</blockquote></li>
<li><p>
<b>誤差項</b> を含む確率モデルで観測データを表現:
</p>
<blockquote>
<div>
\begin{equation}
  y_i=\beta_0+\beta_1 x_{i1}+\cdots+\beta_px_{ip}+\epsilon_i
  \quad (i=1,\dotsc,n)
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org5bebc49">
<h3 id="org5bebc49">問題設定</h3>
<ul>
<li><p>
確率モデル:
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{y}
  =X\boldsymbol{\beta}+\boldsymbol{\epsilon}
\end{equation}

</div>
</blockquote></li>
<li><p>
式の評価: <b>残差平方和</b> の最小化による推定
</p>
<blockquote>
<div>
\begin{equation}
  S(\boldsymbol{\beta})
  =(\boldsymbol{y}-X\boldsymbol{\beta})^{\mathsf{T}}
  (\boldsymbol{y}-X\boldsymbol{\beta})
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orge4fe8a2">
<h3 id="orge4fe8a2">解</h3>
<ul>
<li><p>
解の条件: <b>正規方程式</b>
</p>
<blockquote>
<div>
\begin{equation}
  X^{\mathsf{T}}X\boldsymbol{\beta}
  =X^{\mathsf{T}}\boldsymbol{y}
\end{equation}

</div>
</blockquote></li>
<li><p>
解の一意性: <b>Gram 行列</b> \(X^{\mathsf{T}}X\) が正則
</p>
<blockquote>
<div>
\begin{equation}
  \hat{\boldsymbol{\beta}}
  =
  (X^{\mathsf{T}}X)^{-1}
  X^{\mathsf{T}}\boldsymbol{y}  
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgb20d33d">
<h3 id="orgb20d33d">寄与率</h3>
<ul>
<li><p>
<b>決定係数</b> (R-squared):
</p>
<blockquote>
<div>
\begin{equation}
  R^2
  =
  1-\frac{\sum_{i=1}^n\hat{\epsilon}_i^2}{\sum_{i=1}^n(y_i-\bar{y})^2}
\end{equation}

</div>
</blockquote></li>
<li><p>
<b>自由度調整済み決定係数</b> (adjusted R-squared):
</p>
<blockquote>
<div>
\begin{equation}
  \bar{R}^2
  =
  1-\frac{\frac{1}{n{-}p{-}1}\sum_{i=1}^n\hat{\epsilon}_i^2}
  {\frac{1}{n{-}1}\sum_{i=1}^n(y_i-\bar{y})^2}
\end{equation}

</div>

<p>
不偏分散で補正
</p>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgd400950">
<h3 id="orgd400950">事例</h3>
<ul>
<li><p>
東京の8月の気候 (気温,降雨,日射,降雪,風速,気圧,湿度,雲量)
に関するデータ(の一部)
</p>
<pre class="example">
	 date temp rain solar snow wind  press humid cloud
213  2019/8/1 30.5  0.0 20.55    0  2.5 1008.5    80   1.8
214  2019/8/2 30.2  0.0 20.24    0  2.7 1008.4    80   2.8
215  2019/8/3 29.4  0.0 25.03    0  2.9 1008.7    78   1.0
216  2019/8/4 29.4  0.0 24.62    0  2.8 1009.5    76   3.0
217  2019/8/5 29.8  0.0 26.72    0  3.0 1009.5    75   2.8
218  2019/8/6 30.3  0.0 24.18    0  3.8 1008.4    76   7.5
219  2019/8/7 30.4  0.0 24.10    0  3.1 1007.4    74   6.5
220  2019/8/8 29.9  0.0 22.46    0  2.8 1006.6    78   4.3
221  2019/8/9 30.1  0.0 25.10    0  3.3 1005.5    74   6.5
222 2019/8/10 29.6  0.0 22.69    0  3.2 1005.4    76   4.3
223 2019/8/11 29.4  0.0 23.77    0  2.8 1005.9    76   6.0
224 2019/8/12 28.8  0.5 17.16    0  2.6 1005.7    81  10.0
225 2019/8/13 29.3  0.0 15.57    0  2.6 1003.8    83   6.8
226 2019/8/14 29.2  8.5 15.38    0  3.8 1003.4    85   9.0
</pre></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>作成した線形回帰モデルを検討する
<ul>
<li>モデル1: 気温 = F(気圧)</li>
<li>モデル2: 気温 = F(気圧, 日射)</li>
<li>モデル3: 気温 = F(気圧, 日射, 湿度)</li>
<li>モデル4: 気温 = F(気圧, 日射, 雲量)</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
説明変数と目的変数の関係
</p></li>

</ul>


<div id="org1948e12" class="figure">
<p><img src="figs/05_variables.png" alt="05_variables.png" />
</p>
<p><span class="figure-number">Figure 1: </span>説明変数と目的変数の散布図</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
観測値とあてはめ値の比較
</p></li>

</ul>


<div id="org29a7998" class="figure">
<p><img src="figs/05_models.png" alt="05_models.png" />
</p>
<p><span class="figure-number">Figure 2: </span>モデルの比較</p>
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org5c7781c">
<h3 id="org5c7781c">モデルの評価</h3>
<ul>
<li><p>
決定係数
</p>
<ul>
<li>モデル1</li>

</ul>
<pre class="example">
[1] "R2: 0.0288 ; adj. R2: -0.00465"
</pre>


<ul>
<li>モデル2</li>

</ul>
<pre class="example">
[1] "R2: 0.633 ; adj. R2: 0.607"
</pre>


<ul>
<li>モデル3 (モデル2より改善しているとは言えない)</li>

</ul>
<pre class="example">
[1] "R2: 0.633 ; adj. R2: 0.592"
</pre>


<ul>
<li>モデル4 (モデル2より改善している)</li>

</ul>
<pre class="example">
[1] "R2: 0.653 ; adj. R2: 0.614"
</pre></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgddb975f">
<h3 id="orgddb975f">\(F\)-統計量による検定</h3>
<ul>
<li>説明変数のうち1つでも役に立つか否かを検定する
<ul>
<li>帰無仮説: \(\beta_1=\dotsb=\beta_p=0\)</li>
<li>対立仮説: \(\exists j\;\beta_j\neq0\) (少なくとも1つは役に立つ)</li>

</ul></li>
<li><p>
\(F\)-統計量: 決定係数(または残差)を用いて計算
</p>
<blockquote>
<div>
\begin{equation}
  F
  =\frac{n{-}p{-}1}{p}\frac{R^2}{1-R^2}
\end{equation}

</div>
</blockquote></li>
<li>\(p\) -値: 自由度 \(p,n{-}p{-}1\) の \(F\) 分布で計算</li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org12ae44c">
<h3 id="org12ae44c">モデルの評価</h3>
<ul>
<li><p>
決定係数と\(F\)-統計量
</p>
<ul>
<li>モデル1</li>

</ul>
<pre class="example">
[1] "R2: 0.0288 ; adj. R2: -0.00465 ; F-stat: 0.861 ; p-val: 0.361"
</pre>


<ul>
<li>モデル2</li>

</ul>
<pre class="example">
[1] "R2: 0.633 ; adj. R2: 0.607 ; F-stat: 24.2 ; p-val: 7.98e-07"
</pre>


<ul>
<li>モデル3</li>

</ul>
<pre class="example">
[1] "R2: 0.633 ; adj. R2: 0.592 ; F-stat: 15.5 ; p-val: 4.55e-06"
</pre>


<ul>
<li>モデル4</li>

</ul>
<pre class="example">
[1] "R2: 0.653 ; adj. R2: 0.614 ; F-stat: 16.9 ; p-val: 2.18e-06"
</pre></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgda94686">
<h3 id="orgda94686">\(t\)-統計量による検定</h3>
<ul>
<li>回帰係数 \(\beta_j\) が回帰式に寄与するか否かを検定する
<ul>
<li>帰無仮説: \(\beta_j=0\)</li>
<li>対立仮説: \(\beta_j\neq0\) (\(\beta_j\) は役に立つ)</li>

</ul></li>
<li><p>
\(t\)-統計量: 各係数ごと，\(\xi\) は \((X^{\mathsf{T}} X)^{-1}\) の対角成分
</p>
<blockquote>
<div>
\begin{equation}
  t=\frac{\hat{\beta}_j}{\hat{\sigma}\sqrt{\xi_j}}
\end{equation}

</div>
</blockquote></li>
<li>\(p\) -値: 自由度 \(n{-}p{-}1\) の \(t\) 分布を用いて計算</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgfebfb8a">
<h3 id="orgfebfb8a">モデルの評価</h3>
<ul>
<li><p>
回帰係数の推定量と\(t\)-統計量
</p>
<ul>
<li>モデル1</li>

</ul>
<pre class="example">
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) 117.0000    95.9000   1.220    0.231
press        -0.0885     0.0953  -0.928    0.361
</pre>


<ul>
<li>モデル2</li>

</ul>
<pre class="example">
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)  197.000    61.1000    3.23 3.17e-03
press         -0.171     0.0609   -2.82 8.77e-03
solar          0.209     0.0307    6.79 2.23e-07
</pre></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
回帰係数の推定量と\(t\)-統計量 (つづき)
</p>
<ul>
<li>モデル3</li>

</ul>
<pre class="example">
             Estimate Std. Error  t value Pr(&gt;|t|)
(Intercept) 197.00000    62.6000  3.15000  0.00394
press        -0.17100     0.0633 -2.71000  0.01160
solar         0.20900     0.0601  3.47000  0.00177
humid        -0.00011     0.0680 -0.00161  0.99900
</pre>


<ul>
<li>モデル4 (雲量の回帰係数は有用でないことを示唆)</li>

</ul>
<pre class="example">
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)  198.000    60.5000    3.27 0.002900
press         -0.171     0.0603   -2.83 0.008600
solar          0.167     0.0451    3.72 0.000934
cloud         -0.130     0.1050   -1.24 0.225000
</pre></li>

</ul>

<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org7389b69">
<h2 id="org7389b69">回帰モデルによる予測</h2>
<div class="outline-text-2" id="text-org7389b69">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgc2ef2ef">
<h3 id="orgc2ef2ef">予測</h3>
<ul>
<li><p>
新しいデータ (説明変数) \(\boldsymbol{x}\) に対する <b>予測値</b>
</p>
<blockquote>
<div>
\begin{equation}
  \hat{y}
  =
  (1,\boldsymbol{x}^{\mathsf{T}})\hat{\boldsymbol{\beta}},
  \qquad
  \hat{\boldsymbol{\beta}}
  =
  (X^{\mathsf{T}}X)^{-1}
  X^{\mathsf{T}}\boldsymbol{y}
\end{equation}

</div>
</blockquote></li>
<li><p>
予測値は元データの目的変数の重み付け線形和
</p>
<blockquote>
<div>
\begin{equation}
  \hat{y}
  =
  \boldsymbol{w}(\boldsymbol{x})^{\mathsf{T}}\boldsymbol{y}
\end{equation}

</div>

<p>
重みは元データと新規データの説明変数で決定
</p>
<div>
\begin{equation}
  \boldsymbol{w}(\boldsymbol{x})^{\mathsf{T}}
  =
  (1,\boldsymbol{x}^{\mathsf{T}})
  (X^{\mathsf{T}}X)^{-1}
  X^{\mathsf{T}}
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org5d10737">
<h3 id="org5d10737">予測値の性質</h3>
<ul>
<li><p>
推定量は以下の性質をもつ多変量正規分布
</p>
<blockquote>
<div>
\begin{align}
  \mathbb{E}[\hat{\boldsymbol{\beta}}]
  &=\boldsymbol{\beta}\\
  \mathrm{Cov}(\hat{\boldsymbol{\beta}})
  &=\sigma^{2}(X^{\mathsf{T}}X)^{-1}
\end{align}

</div>
</blockquote></li>
<li><p>
この性質を利用して以下の3つの値の違いを評価
</p>
<blockquote>
<div>
\begin{align}
  \hat{y}&=(1,\boldsymbol{x}^{\mathsf{T}})\hat{\boldsymbol{\beta}}
  &&\text{(回帰式による予測値)}\\
  \tilde{y}&=(1,\boldsymbol{x}^{\mathsf{T}})\boldsymbol{\beta}
  &&\text{(最適な予測値)}\\
  y&=(1,\boldsymbol{x}^{\mathsf{T}})\boldsymbol{\beta}+\epsilon
  &&\text{(観測値)}
\end{align}

</div>

<p>
\(\hat{y}\) と \(y\) は独立な正規分布に従うことに注意
</p>
</blockquote></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org1bd7dcc" data-background="#fef4f4">
<h2 id="org1bd7dcc">演習</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org4cf5013" data-background="#fef4f4">
<h3 id="org4cf5013">問題</h3>
<ul>
<li>誤差が平均0，分散 \(\sigma^{2}\) の正規分布に従うとき，
以下の問について答えなさい．
<ul>
<li>予測値 \(\hat{y}\) の平均を求めなさい．</li>
<li>予測値 \(\hat{y}\) の分散を求めなさい．</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgb162b31" data-background="#fef4f4">
<h3 id="orgb162b31">解答例</h3>
<ul>
<li><p>
定義にもとづいて計算する
</p>
<blockquote>
<div>
\begin{align}
  \mathbb{E}[\hat{y}]
  &=
    \mathbb{E}[(1,\boldsymbol{x}^{\mathsf{T}})\hat{\boldsymbol{\beta}}]\\
  &=
    (1,\boldsymbol{x}^{\mathsf{T}})\mathbb{E}[\hat{\boldsymbol{\beta}}]\\
  &=
    (1,\boldsymbol{x}^{\mathsf{T}})\boldsymbol{\beta}\\
  &=
    \tilde{y}
\end{align}

</div>

<p>
真の回帰式による最適な予測値
</p>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section data-background="#fef4f4">
<ul>
<li><p>
定義にもとづいて計算する
</p>
<blockquote>
<div>
\begin{align}
  \mathrm{Var}(\hat{y})
  &=
    \mathrm{Var}((1,\boldsymbol{x}^{\mathsf{T}})
    (\hat{\boldsymbol{\beta}}-\boldsymbol{\beta}))\\
  &=
    (1,\boldsymbol{x}^{\mathsf{T}})
    \mathrm{Cov}(\hat{\boldsymbol{\beta}}-\boldsymbol{\beta})
    (1,\boldsymbol{x}^{\mathsf{T}})^{\mathsf{T}}\\
  &=
    (1,\boldsymbol{x}^{\mathsf{T}})
    \mathrm{Cov}(\hat{\boldsymbol{\beta}})
    (1,\boldsymbol{x}^{\mathsf{T}})^{\mathsf{T}}\\
  &=
    (1,\boldsymbol{x}^{\mathsf{T}})
    \sigma^{2}
    (X^{\mathsf{T}}X)^{-1}
    (1,\boldsymbol{x}^{\mathsf{T}})^{\mathsf{T}}\\
  &=
    \sigma^{2}
    (1,\boldsymbol{x}^{\mathsf{T}})
    (X^{\mathsf{T}}X)^{-1}
    (1,\boldsymbol{x}^{\mathsf{T}})^{\mathsf{T}}
\end{align}

</div>
</blockquote></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orge9141d4">
<h2 id="orge9141d4">信頼区間</h2>
<div class="outline-text-2" id="text-orge9141d4">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org24c2ab4">
<h3 id="org24c2ab4">最適な予測値との差</h3>
<ul>
<li><p>
差の分布は以下の平均・分散の正規分布
</p>
<blockquote>
<div>
\begin{align}
  \check{\boldsymbol{x}}^{\mathsf{T}}&=(1,\boldsymbol{x}^{\mathsf{T}})\\
  \mathbb{E}[\tilde{y}-\hat{y}]
				     &=\check{\boldsymbol{x}}^{\mathsf{T}}\boldsymbol{\beta}
				       -\check{\boldsymbol{x}}^{\mathsf{T}}
				       \mathbb{E}[\hat{\boldsymbol{\beta}}]
				       =0\\
  \mathrm{Var}(\tilde{y}-\hat{y})
				     &=\underbrace{\sigma^{2}\check{\boldsymbol{x}}^{\mathsf{T}}
				       (X^{\mathsf{T}}X)^{-1}\check{\boldsymbol{x}}
				       }_{\text{$\hat{\boldsymbol{\beta}}$の推定誤差による分散}}
				       =\sigma^{2}\gamma_{c}(\boldsymbol{x})^{2}
\end{align}

</div>
</blockquote></li>
<li><p>
正規化による表現
</p>
<blockquote>
<div>
\begin{equation}
  \frac{\tilde{y}-\hat{y}}{\sigma\gamma_{c}(\boldsymbol{x})}
  \sim \mathcal{N}(0,1)
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgd43735f">
<h3 id="orgd43735f">信頼区間</h3>
<ul>
<li><p>
未知の分散を不偏分散で推定
</p>
<blockquote>
<div>
\begin{equation}
  Z=
  \frac{\tilde{y}-\hat{y}}{\hat{\sigma}\gamma_{c}(\boldsymbol{x})}
  \sim \mathcal{T}(n{-}p{-}1) 
  \quad (\text{$t$-分布})
\end{equation}

</div>
</blockquote></li>
<li><p>
確率 \(\alpha\) の信頼区間 <br />
(最適な予測値 \(\tilde{y}\) が入ることが期待される区間)
</p>
<blockquote>
<div>
\begin{equation}
  \mathcal{I}^{c}_{\alpha}
  =
  \left(
    \hat{y}-C_{\alpha}\hat{\sigma}\gamma_{c}(\boldsymbol{x}),\;
    \hat{y}+C_{\alpha}\hat{\sigma}\gamma_{c}(\boldsymbol{x})
  \right)
\end{equation}

</div>

<p>
ただし \(C_{\alpha}\) は以下を満たす定数
</p>
<div>
\begin{equation}
  P(|Z| < {C_{\alpha}} | Z\sim\mathcal{T}(n{-}p{-}1))
  =\alpha
\end{equation}

</div>
</blockquote></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orgdf74859" data-background="#fef4f4">
<h2 id="orgdf74859">演習</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgcf18319" data-background="#fef4f4">
<h3 id="orgcf18319">問題</h3>
<ul>
<li>以下の問に答えなさい．
<ul>
<li><p>
信頼区間について以下の式が成り立つことを示しなさい．
</p>
<blockquote>
<div>
\begin{equation}
  P(\tilde{y}\in\mathcal{I}^{c}_{\alpha})
  =\alpha
\end{equation}

</div>
</blockquote></li>
<li>観測値と予測値の差 \(y-\hat{y}\) の平均と分散を求めなさい．</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgbfc993d" data-background="#fef4f4">
<h3 id="orgbfc993d">解答例</h3>
<ul>
<li><p>
\(C_{\alpha}\) の定義にもとづいて計算すればよい
</p>
<blockquote>
<div>
\begin{align}
  \alpha
  &=
    P(|Z| < {C_{\alpha}})\\
  &=
    P\left(
    \left|\frac{\tilde{y}-\hat{y}}{\hat{\sigma}\gamma_{c}(\boldsymbol{x})}\right|
    < {C_{\alpha}}
    \right)\\
  &=
    P\left(
    |\tilde{y}-\hat{y}|
    < C_{\alpha}\hat{\sigma}\gamma_{c}(\boldsymbol{x})
    \right)\\
  &=
    P\left(
    -C_{\alpha}\hat{\sigma}\gamma_{c}(\boldsymbol{x})
    < \tilde{y}-\hat{y}
    < C_{\alpha}\hat{\sigma}\gamma_{c}(\boldsymbol{x})
    \right)\\
  &=
    P\left(
    \hat{y}-C_{\alpha}\hat{\sigma}\gamma_{c}(\boldsymbol{x})
    < \tilde{y}
    < \hat{y}+C_{\alpha}\hat{\sigma}\gamma_{c}(\boldsymbol{x})
    \right)
\end{align}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section data-background="#fef4f4">
<ul>
<li><p>
定義にもとづいて計算する
</p>
<blockquote>
<div>
\begin{align}
  \mathbb{E}[y-\hat{y}]
  &=
    \mathbb{E}[y]
    -\mathbb{E}[\hat{y}]\\
  &=
    \tilde{y}-\tilde{y}\\
  &=
    0\\
  \mathrm{Var}(y-\hat{y})
  &=
    \mathrm{Var}(y)
    +\mathrm{Var}(\hat{y})\\
  &=
    \sigma^{2}
    +
    \sigma^{2}
    (1,\boldsymbol{x}^{\mathsf{T}})
    (X^{\mathsf{T}}X)^{-1}
    (1,\boldsymbol{x}^{\mathsf{T}})^{\mathsf{T}}
\end{align}

</div>
</blockquote></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org65f7499">
<h2 id="org65f7499">予測区間</h2>
<div class="outline-text-2" id="text-org65f7499">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org7a55e1a">
<h3 id="org7a55e1a">観測値との差</h3>
<ul>
<li><p>
差の分布は以下の平均・分散の正規分布
</p>
<blockquote>
<div>
\begin{align}
  \mathbb{E}[y-\hat{y}]
  &=\check{\boldsymbol{x}}^{\mathsf{T}}\boldsymbol{\beta}
    +\mathbb{E}[\boldsymbol{\epsilon}]
    -\check{\boldsymbol{x}}^{\mathsf{T}}
    \mathbb{E}[\hat{\boldsymbol{\beta}}]
    =0\\
  \mathrm{Var}(y-\hat{y})
  &=\underbrace{\sigma^{2}\check{\boldsymbol{x}}^{\mathsf{T}}
    (X^{\mathsf{T}}X)^{-1}\check{\boldsymbol{x}}
    }_{\text{$\hat{\boldsymbol{\beta}}$の推定誤差による分散}}
    +\underbrace{\sigma^{2}}_{\text{誤差の分散}}
    =\sigma^{2}\gamma_{p}(\boldsymbol{x})^{2}
\end{align}

</div>
</blockquote></li>
<li><p>
正規化による表現
</p>
<blockquote>
<div>
\begin{equation}
  \frac{y-\hat{y}}{\sigma\gamma_{p}(\boldsymbol{x})}
  \sim \mathcal{N}(0,1)
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgd7cec0d">
<h3 id="orgd7cec0d">予測区間</h3>
<ul>
<li><p>
未知の分散を不偏分散で推定
</p>
<blockquote>
<div>
\begin{equation}
  Z=
  \frac{y-\hat{y}}{\hat{\sigma}\gamma_{p}(\boldsymbol{x})}
  \sim \mathcal{T}(n{-}p{-}1) 
  \quad (\text{$t$-分布})
\end{equation}

</div>
</blockquote></li>
<li><p>
確率 \(\alpha\) の予測区間 <br />
(観測値 \(y\) が入ることが期待される区間)
</p>
<blockquote>
<div>
\begin{equation}
  \mathcal{I}^{p}_{\alpha}
  =
  \left(
    \hat{y}-C_{\alpha}\hat{\sigma}\gamma_{p}(\boldsymbol{x}),\;
    \hat{y}+C_{\alpha}\hat{\sigma}\gamma_{p}(\boldsymbol{x})
  \right)
\end{equation}

</div>

<p>
ただし \(C_{\alpha}\) は以下を満たす定数
</p>
<div>
\begin{equation}
  P(|Z| < {C_{\alpha}} | Z\sim\mathcal{T}(n{-}p{-}1))
  =\alpha
\end{equation}

</div>
</blockquote></li>

</ul>

<ul>
<li>\(\gamma_{p}>\gamma_{c}\) なので信頼区間より広くなる</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org521a38e">
<h3 id="org521a38e">事例: 信頼区間と予測区間</h3>
<ul>
<li>東京の気候データを用いて以下を試みる
<ul>
<li><p>
8月のデータで回帰式を推定する
</p>
<blockquote>
<p>
気温 = F(気圧, 日射, 雲量) (モデル4)
</p>
</blockquote></li>
<li>上記のモデルで9月のデータを予測する</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>

<div id="org019fdb1" class="figure">
<p><img src="figs/05_aug_cint.png" alt="05_aug_cint.png" />
</p>
<p><span class="figure-number">Figure 3: </span>8月のあてはめ値の信頼区間</p>
</div>
<div class="slide-footer"><br></div>
</section>
<section>

<div id="org9a992dc" class="figure">
<p><img src="figs/05_sep_cint.png" alt="05_sep_cint.png" />
</p>
<p><span class="figure-number">Figure 4: </span>9月の予測値の信頼区間</p>
</div>
<div class="slide-footer"><br></div>
</section>
<section>

<div id="org23528ca" class="figure">
<p><img src="figs/05_sep_pint.png" alt="05_sep_pint.png" />
</p>
<p><span class="figure-number">Figure 5: </span>9月の予測値の予測区間</p>
</div>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orgbcfefcc">
<h2 id="orgbcfefcc">非線形の関係</h2>
<div class="outline-text-2" id="text-orgbcfefcc">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org69a50d6">
<h3 id="org69a50d6">非線形な関係のモデル化</h3>
<ul>
<li>目的変数 \(Y\)</li>
<li>説明変数 \(X_1,\dotsc,X_p\)</li>
<li>説明変数の追加で対応可能
<ul>
<li>交互作用 (交差項): \(X_iX_j\) のような説明変数の積</li>
<li>非線形変換: \(\log(X_k)\) のような関数による変換</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org92ba90b">
<h3 id="org92ba90b">事例: 非線形な関係を含むモデル</h3>
<ul>
<li><p>
東京の気候データの問題で
</p>
<ul>
<li>日射量，気圧，湿度，雲量の線形回帰モデル</li>
<li>湿度と雲量の交互作用を加えた線形回帰モデル</li>

</ul>
<p>
を比較してみる
</p></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
日射量，気圧，湿度，雲量の線形回帰モデル
</p>
<pre class="example">
             Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) 198.00000    62.0000  3.1900  0.00371
solar         0.16300     0.0701  2.3300  0.02780
press        -0.17000     0.0628 -2.7100  0.01180
humid        -0.00507     0.0675 -0.0751  0.94100
cloud        -0.13000     0.1070 -1.2200  0.23300

[1] "R2: 0.653 ; adj. R2: 0.6 ; F-stat: 12.2 ; p-val: 1e-05"
</pre></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
湿度と雲量の交互作用を加えた線形回帰モデル
</p>
<pre class="example">
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) 199.0000    60.4000    3.30  0.00294
solar         0.1760     0.0687    2.56  0.01690
press        -0.1930     0.0629   -3.07  0.00507
humid         0.2780     0.1920    1.44  0.16100
cloud         2.3400     1.5800    1.48  0.15200
humid:cloud  -0.0316     0.0202   -1.56  0.13100

[1] "R2: 0.684 ; adj. R2: 0.621 ; F-stat: 10.8 ; p-val: 1.27e-05"
</pre></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org39b9fce">
<h2 id="org39b9fce">カテゴリカル変数</h2>
<div class="outline-text-2" id="text-org39b9fce">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgba12478">
<h3 id="orgba12478">カテゴリカル変数</h3>
<ul>
<li>悪性良性や血液型などの数値ではないデータ</li>
<li>適切な方法で数値に変換して対応:
<ul>
<li>2値の場合は0,1を割り当てる
<ul>
<li>悪性:1</li>
<li>良性:0</li>

</ul></li>
<li>3値以上の場合は <b>ダミー変数</b> を利用する (カテゴリ数-1個)
<ul>
<li>A型: (1,0,0)</li>
<li>B型: (0,1,0)</li>
<li>O型: (0,0,1)</li>
<li>AB型: (0,0,0)</li>

</ul></li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgb2f7149">
<h3 id="orgb2f7149">事例: カテゴリカル変数の利用</h3>
<ul>
<li>東京の気候データ(1年分)を用いて
気温を回帰する以下のモデルを検討する
<ul>
<li>降水の有無を表すカテゴリカル変数を用いたモデル
(雨が降ると気温が変化することを検証するモデル)</li>
<li>月をカテゴリカル変数として加えたモデル
(月毎の気温の差を考慮して検証するモデル)</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
降水の有無を表すカテゴリカル変数を用いたモデル
</p>
<pre class="example">
            Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept)    15.80      0.508   31.10 2.77e-104
rainTRUE        1.98      0.848    2.34  1.98e-02

[1] "R2: 0.0149 ; adj. R2: 0.0122 ; F-stat: 5.48 ; p-val: 0.0198"
</pre></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
月をカテゴリカル変数として加えたモデル
</p>
<pre class="example">
	    Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept)     5.67      0.480   11.80  2.10e-27
rainTRUE       -1.21      0.309   -3.91  1.13e-04
month2          1.77      0.697    2.54  1.14e-02
month3          5.28      0.683    7.73  1.15e-13
month4          8.37      0.689   12.20  1.30e-28
month5         14.60      0.679   21.40  8.65e-66
month6         16.60      0.693   24.00  4.94e-76
month7         19.30      0.707   27.20  1.04e-88
month8         23.20      0.685   33.80 1.06e-112
month9         19.80      0.690   28.70  2.38e-94
month10        14.40      0.694   20.80  4.42e-63
month11         7.91      0.691   11.40  5.66e-26
month12         3.19      0.683    4.67  4.26e-06

[1] "R2: 0.887 ; adj. R2: 0.883 ; F-stat: 231 ; p-val: 0"
</pre></li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>
<script src="./reveal.js/plugin/search/search.js"></script>
<script src="./reveal.js/plugin/zoom/zoom.js"></script>
<script src="./reveal.js/plugin/highlight/highlight.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: true,
hashOneBasedIndex: false,
pdfSeparateFragments: false,

overview: true,

transition: 'fade',
transitionSpeed: 'default',
chalkboard: { toggleChalkboardButton: { left: '80px' }, toggleNotesButton: { left: '130px'}}, keyboard: { 69: function() { RevealChalkboard.toggleNotesCanvas() }, 87: function() { RevealChalkboard.toggleChalkboard() }, 67: function() { RevealChalkboard.clear() }, 82: function() { RevealChalkboard.reset() }, 68: function() { RevealChalkboard.download() }, 88: function() { RevealChalkboard.colorNext() }, 89: function() { RevealChalkboard.colorPrev() }},

// Plugins with reveal.js 4.x
plugins: [ RevealNotes, RevealSearch, RevealZoom, RevealHighlight ],

// Optional libraries used to extend reveal.js
dependencies: [
{ src: './reveal.js/plugin/menu/menu.js'},
{ src: './reveal.js/plugin/chalkboard/chalkboard.js'}]

});
</script>
</body>
</html>
