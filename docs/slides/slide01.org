#+TITLE: 講義の概要
#+SUBTITLE: 多変量解析
#+AUTHOR: 村田 昇
#+EMAIL: noboru.murata@eb.waseda.ac.jp
#+DATE: 2020.09.29
:reveal:
#+INCLUDE: "./reveal.js/org/mycourse.org"
#+STARTUP: hidestars content
# C-c C-x C-v でinlineを切り替え
# <m C-i でlatex block (math env用)
# C-c '
:end:

* 講義について
** 講義の概要
   - 講義題目: 多変量解析
   - 担当: 村田 昇
   - 授業の目標 
     - 統計解析手法である *多変量解析*
       の基本的な解析法に習熟する
       - 大規模データから効果的に情報を抽出する
       - データの背後に潜む統計的構造を分析する
     - 解析法の数理科学的側面を理解する
     - 実データに多変量解析を適用する
** 多変量解析とは
   複数の変量からなるデータを分析する手法の総称
   - *回帰分析*: 複数の量を用いて注目する変数の値を説明する
   - *主成分分析*: 全体を説明する少数の特徴量を構成する
   - *判別分析*: 特徴量の違いでカテゴリ分けを行う
   - *クラスタ分析*: 特徴量の違いに着目してクラスタを構成する
   - *時系列解析*: 時間とともに変化する現象を記述する

** 受講にあたっての注意
   - 微分積分学と線形代数学を復習しておくこと
   - 自身で解析のための計算機環境を準備すること
   - 講義の資料は Moodle および Web で公開する
   - 成績評価は課題の提出(2回)による

** 講義計画 (予定)
  - オリエンテーション 
  - 数学的準備 (1回)
  - 回帰分析 (3回)
  - 第1回レポート (回帰分析) (11/24締切) 
  - 主成分分析 (2回)
  - 判別分析 (2回)
  - クラスタ分析 (2回)
  - 時系列解析入門 (2回)
  - 第2回レポート (自由課題) (1/31締切) 

* 多変量解析
** 多変量解析とは  
   - 複数の変量からなるデータを分析する手法の総称
     - 回帰分析: 複数の量を用いて注目する変数の値を説明する
     - 主成分分析: 全体を説明する少数の特徴量を構成する
     - 判別分析: 特徴量の違いでカテゴリ分けを行う
     - クラスタ分析: 特徴量の違いに着目してクラスタを構成する
     - 時系列解析: 時間とともに変化する現象を記述する

** 回帰分析の考え方
   - ある変数を別の変数によって説明・予測するための関係式(回帰式)を構成する
     - 単回帰: 一つの変数で目的変数を説明する
     - 重回帰: 複数の変数で目的変数を説明する
   - 分析の事例:
     - 身長から体重を予測する式を作り，ある身長の人がある体重だったときに，それが普通かどうか判定する
     - 築年数・駅からの距離・広さ・間取りで家賃を説明する式を作り，新規に家賃を設定する際に利用する

   # ある1種類の変数/データを別の変数/データ(1種類もしくは複数)によって説明もしくは予測するための関係式(回帰方程式)を構成することを目的とする分析法
   # ある量(説明変数)を用いて注目する量(目的変数)を説明する

** 単回帰の例 
   #+CAPTION: 体重と脳の重さ 
   #+NAME:   tbl:brainbody
   |                 | body [kg] | brain [g] |
   |-----------------+-----------+-----------|
   | Mountain beaver |     1.350 |       8.1 |
   | Cow             |   465.000 |     423.0 |
   | Grey wolf       |    36.330 |     119.5 |
   | Goat            |    27.660 |     115.0 |
   | Guinea pig      |     1.040 |       5.5 |
   | Dipliodocus     | 11700.000 |      50.0 |
   | Asian elephant  |  2547.000 |    4603.0 |
   | Donkey          |   187.100 |     419.0 |
   | ...             |           |           |

   #+REVEAL: split
   #+CAPTION: 体重と脳の重さの関係 (単回帰)
   #+NAME:   fig:r-brainbody05
   #+ATTR_HTML: 
   [[file:./figs/r-brainbody05.png]]

** 重回帰の例
   #+CAPTION: ワインの価格と生産環境
   #+NAME:   tbl:wine
   | 年号 | 価格(対数) | 冬の降雨 |    気温 | 秋の降雨 | 経過年 |
   |------+------------+----------+---------+----------+--------|
   | 1952 |   -0.99868 |      600 | 17.1167 |      160 |     31 |
   | 1953 |    -0.4544 |      690 | 16.7333 |       80 |     30 |
   | 1954 |         NA |      430 | 15.3833 |      180 |     29 |
   | 1955 |   -0.80796 |      502 |   17.15 |      130 |     28 |
   | 1956 |         NA |      440 |   15.65 |      140 |     27 |
   | 1957 |   -1.50926 |      420 | 16.1333 |      110 |     26 |
   | 1958 |   -1.71655 |      582 | 16.4167 |      187 |     25 |
   | 1959 |     -0.418 |      485 | 17.4833 |      187 |     24 |
   |  ... |            |          |         |          |        |

   #+REVEAL: split
   #+CAPTION: ワインの価格と生産環境の関係
   #+NAME:   fig:r-wine01
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/r-wine01.png]]

   #+REVEAL: split
   #+CAPTION: 生産環境によるワイン価格の予測 (重回帰)
   #+NAME:   fig:r-wine05
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/r-wine05.png]]

** 主成分分析の考え方
   - 多数の変数が与えられたときに，変数のもつ構造を効率的に記述できる少数個の特徴量を構成する
   - 分析の事例:
     - 野球選手の打撃成績(打率，本塁打数，打点など)から，打者としての特徴を記述する指標を作成する
     - 複数銘柄からなる株価の時系列データから，市場全体の変動を記述する総合指標を作成する
   # 全体を説明する少数の特徴量を構成する

** 主成分分析の例
   #+CAPTION: 県別の生活環境(一部)
   #+NAME:   tbl:jpamenity
   |      | 昼夜人口比 | 年少人口比 | 老年人口比 | 人口増減率 |
   |----------+------------+------------+------------+------------|
   | 北海道   |      100.0 |       11.7 |       26.0 |      -0.47 |
   | 青森県   |      100.0 |       12.1 |       27.0 |      -0.95 |
   | 岩手県   |       99.7 |       12.4 |       27.9 |      -0.84 |
   | 宮城県   |      100.2 |       13.0 |       22.9 |      -0.09 |
   | 秋田県   |       99.9 |       11.1 |       30.7 |      -1.12 |
   | 山形県   |       99.8 |       12.6 |       28.3 |      -0.78 |
   | 福島県   |       99.6 |       12.9 |       26.1 |      -1.41 |
   | 茨城県   |       97.2 |       13.2 |       23.8 |      -0.51 |
   | ...      |            |            |            |            |

   #+REVEAL: split
   #+CAPTION: 県別の生活環境(人口動態)の散布図 
   #+NAME:   fig:p-jpamenity01
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/p-jpamenity01.png]]

   #+REVEAL: split
   #+CAPTION: 県別の生活環境(教育・労働)の散布図 
   #+NAME:   fig:p-jpamenity02
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/p-jpamenity02.png]]

   #+REVEAL: split
   #+CAPTION: 県別の生活環境(貯蓄・余暇)の散布図 
   #+NAME:   fig:p-jpamenity03
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/p-jpamenity03.png]]

   #+REVEAL: split
   #+CAPTION: 県別の生活環境の主成分分析
   #+NAME:   fig:p-jpamenity06
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/p-jpamenity06.png]]

** 判別分析の考え方
   - ある個体が複数のクラスのいずれかに属するとき，その個体の特徴量からどのクラスに属するか予測するモデルを構築する
   - 分析の事例:
     - 花の種類を，その花の花弁の幅・長さおよび萼片(がくへん)の幅・長さから判別する
     - 食道がんを患っている人とそうでない人を，年齢・飲酒量・喫煙度から判別する
   # 特徴量の違いでカテゴリ分けを行う
** 判別分析の例
   #+CAPTION: 乳癌患者の生研検査
   #+NAME:   tbl:biopsy
   |      ID | V1 | V2 | V3 | V4 | V5 | V6 | V7 | V8 | V9 | class     |
   |---------+----+----+----+----+----+----+----+----+----+-----------|
   | 1000025 |  5 |  1 |  1 |  1 |  2 |  1 |  3 |  1 |  1 | benign    |
   | 1002945 |  5 |  4 |  4 |  5 |  7 | 10 |  3 |  2 |  1 | benign    |
   | 1015425 |  3 |  1 |  1 |  1 |  2 |  2 |  3 |  1 |  1 | benign    |
   | 1016277 |  6 |  8 |  8 |  1 |  3 |  4 |  3 |  7 |  1 | benign    |
   | 1017023 |  4 |  1 |  1 |  3 |  2 |  1 |  3 |  1 |  1 | benign    |
   | 1017122 |  8 | 10 | 10 |  8 |  7 | 10 |  9 |  7 |  1 | malignant |
   | 1018099 |  1 |  1 |  1 |  1 |  2 | 10 |  3 |  1 |  1 | benign    |
   | 1018561 |  2 |  1 |  2 |  1 |  2 |  1 |  3 |  1 |  1 | benign    |
   |     ... |    |    |    |    |    |    |    |    |    |           |

   #+REVEAL: split
   #+CAPTION: 乳癌患者(良性・悪性)の生研検査の散布図
   #+NAME:   fig:d-biopsy01
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/d-biopsy01.png]]

   #+REVEAL: split
   #+CAPTION: 生研検査の主成分分析
   #+NAME:   fig:d-biopsy02
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/d-biopsy02.png]]

   #+REVEAL: split
   #+CAPTION: 生研検査による乳癌患者の判別分析
   #+NAME:   fig:d-biopsy03
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/d-biopsy03.png]]

** クラスタ分析の考え方
   - 特徴量の違いに着目して，妥当な個体のグループ(クラスタ)を構成する
     - 階層的な方法: 系統樹を作成する
     - 非階層的な方法: グループの代表値を推定する
   - 分析の事例:
     - 映画に関するアンケート調査から潜在的なジャンル(グループ)を抽出する
     - 顧客の購買履歴から，嗜好の異なる顧客グループに分類し，グループごとの販売戦略を立てる

** クラスタ分析の例
   #+CAPTION: おむすびの具に関するアンケート
   #+NAME:   tbl:omusubi
   |        |    梅 |    鮭 | 昆布 |   鰹 |  明太 |  鱈子 |  ツナ |    他 |
   |--------+-------+-------+------+------+-------+-------+-------+-------|
   | 北海道 | 13.86 | 27.94 | 5.58 | 5.26 |  9.26 | 15.06 | 11.61 | 11.39 |
   | 青森   | 14.93 | 30.79 | 7.01 | 2.43 | 10.36 | 11.58 | 11.58 | 11.28 |
   | 岩手   | 17.91 | 23.13 | 5.22 | 3.35 | 17.91 | 10.07 | 10.44 | 11.94 |
   | 宮城   | 15.16 |  29.5 |   10 | 1.66 | 14.83 |  8.83 | 12.83 |  7.16 |
   | 秋田   | 10.63 | 31.38 | 5.31 | 3.19 | 14.89 | 13.29 | 10.63 | 10.63 |
   | 山形   | 16.58 | 20.27 | 8.29 | 1.38 | 18.89 | 10.13 |  12.9 | 11.52 |
   | 福島   | 12.37 | 21.99 | 8.93 | 3.43 | 16.49 |  9.62 | 19.24 |   7.9 |
   | 茨城   | 15.42 | 26.49 | 7.98 | 2.54 | 18.33 | 11.79 | 11.79 |  5.62 |
   | ...    |       |       |      |      |       |       |       |       |

   #+REVEAL: split
   #+CAPTION: おむすびの具に関するアンケート分析 (県別の集計)
   #+NAME:   fig:c-omusubi01
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/c-omusubi01.png]]

   #+REVEAL: split
   #+CAPTION: アンケート結果にもとづく県のクラスタ分析
   #+NAME:   fig:c-omusubi02
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/c-omusubi02.png]]

** 時系列解析の考え方
   - 時間とともに変化する現象を記述するために，未来の値を過去の値で近似する式を構成する
     - 自己回帰 (ARモデル): 過去の影響の記述
     - 移動平均 (MAモデル): 記憶のある不確定性
   - 分析の事例:
     - 市町村の過去の年齢別の人口変動から将来の人口比率を予測する
     - 食品・飲料の季節ごとの販売履歴から将来の需要量を予測する
** 時系列解析の例
   #+CAPTION: 航空機旅客量の変遷
   #+NAME:   tbl:airpass
   |      | Jan | Feb | Mar | Apr | May | Jun | Jul | Aug | Sep | ... |
   |------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----|
   | 1949 | 112 | 118 | 132 | 129 | 121 | 135 | 148 | 148 | 136 | ... |
   | 1950 | 115 | 126 | 141 | 135 | 125 | 149 | 170 | 170 | 158 | ... |
   | 1951 | 145 | 150 | 178 | 163 | 172 | 178 | 199 | 199 | 184 | ... |
   | 1952 | 171 | 180 | 193 | 181 | 183 | 218 | 230 | 242 | 209 | ... |
   | 1953 | 196 | 196 | 236 | 235 | 229 | 243 | 264 | 272 | 237 | ... |
   | 1954 | 204 | 188 | 235 | 227 | 234 | 264 | 302 | 293 | 259 | ... |
   | 1955 | 242 | 233 | 267 | 269 | 270 | 315 | 364 | 347 | 312 | ... |
   |  ... |     |     |     |     |     |     |     |     |     |     |

   # |      | Jan | Feb | Mar | Apr | May | Jun | Jul | Aug | Sep | Oct | Nov | Dec |
   # | 1949 | 112 | 118 | 132 | 129 | 121 | 135 | 148 | 148 | 136 | 119 | 104 | 118 |
   # | 1950 | 115 | 126 | 141 | 135 | 125 | 149 | 170 | 170 | 158 | 133 | 114 | 140 |
   # | 1951 | 145 | 150 | 178 | 163 | 172 | 178 | 199 | 199 | 184 | 162 | 146 | 166 |
   # | 1952 | 171 | 180 | 193 | 181 | 183 | 218 | 230 | 242 | 209 | 191 | 172 | 194 |
   # | 1953 | 196 | 196 | 236 | 235 | 229 | 243 | 264 | 272 | 237 | 211 | 180 | 201 |
   # | 1954 | 204 | 188 | 235 | 227 | 234 | 264 | 302 | 293 | 259 | 229 | 203 | 229 |
   # | 1955 | 242 | 233 | 267 | 269 | 270 | 315 | 364 | 347 | 312 | 274 | 237 | 278 |
   # | 1956 | 284 | 277 | 317 | 313 | 318 | 374 | 413 | 405 | 355 | 306 | 271 | 306 |
   # |  ... |     |     |     |     |     |     |     |     |     |     |     |     |

   #+REVEAL: split
   #+CAPTION: 航空機旅客量の変遷
   #+NAME:   fig:t-airpass01
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/t-airpass01.png]]

   #+REVEAL: split
   #+CAPTION: 階差時系列の自己相関分析
   #+NAME:   fig:t-airpass04
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/t-airpass04.png]]

   #+REVEAL: split
   #+CAPTION: 航空機旅客量の予測 (SARIMAモデルによる)
   #+NAME:   fig:t-airpass12
   #+ATTR_HTML: :width 55% :height 55%
   [[file:./figs/t-airpass12.png]]


* 数学的準備
** 確率
   - 確率分布
   - 確率密度関数・確率質量関数
   - 正規分布 ( $\chi^2$ -分布，$t$ -分布，$F$ -分布 )
   - 最尤法 (尤度関数)
   - 統計量 (標本平均，不偏分散・共分散，相関係数)
   - ベイズの定理
** 関数の微分
   - ベクトルによる微分
   - 行列による微分


* COMMENT ローカル変数
# Local Variables:
# org-latex-listings: minted
# End:
