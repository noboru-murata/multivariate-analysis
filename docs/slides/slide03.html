<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>回帰分析</title>
<meta name="author" content="村田 昇"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/oer-reveal.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/plugin/toc-progress/toc-progress.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/toc-style.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/fonts/source-sans-pro/source-sans-pro.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/accessibility/helper.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/mycourse.css"/>
<link rel="stylesheet" href="./reveal.js/plugin/highlight/zenburn.css"/>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-state="no-toc-progress">
<!-- This is an HTML template for the title slide. -->
<!-- Embed logos as necessary. -->
<!-- <a class="nooutlink" href="url"><img class="state-background your-logo-class" src="whatever.png" alt="Whatever" /></a> -->
<div class="talk-title">
    <h1 class="no-toc-progress">回帰分析</h1>
</div>
<div class="talk-subtitle">
    <p>回帰モデルの考え方と推定</p>
</div>
<div class="keyboard-usage">
    <p>(Press <code>?</code> for help, <code>n</code> and <code>p</code> for next and previous slide)</p>
</div>
<div class="talk-author">
  <p>村田 昇<br />
  </p>
</div>

</section>

<section>
<section id="slide-org12ef0ba">
<h2 id="org12ef0ba">講義の内容</h2>
<ul>
<li><b>第1回: 回帰モデルの考え方と推定</b></li>
<li>第2回: モデルの評価</li>
<li>第3回: モデルによる予測と発展的なモデル</li>

</ul>
<div class="slide-footer"><br></div>

</section>
</section>
<section>
<section id="slide-org20dd51a">
<h2 id="org20dd51a">回帰分析の考え方</h2>
<div class="outline-text-2" id="text-org20dd51a">
</div>
</section>
<section id="slide-org463b3f0">
<h3 id="org463b3f0">回帰分析</h3>
<ul>
<li>ある変量を別の変量で説明する関係式を構成する</li>
<li>関係式 : <b>回帰式</b> (regression equation)
<ul>
<li>説明される側 : <b>目的変数</b>, 被説明変数, 従属変数, 応答変数</li>
<li>説明する側 : <b>説明変数</b>, 独立変数, 共変量</li>

</ul></li>
<li>説明変数の数による分類
<ul>
<li>一つの場合 : <b>単回帰</b> (simple regression)</li>
<li>複数の場合 : <b>重回帰</b> (multiple regression)</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orge223b20">
<h3 id="orge223b20">一般の回帰の枠組</h3>
<ul>
<li>説明変数 : \(x_{1},\dotsc,x_{p}\) (p次元)</li>
<li>目的変数 : \(y\) (1次元)</li>
<li><p>
回帰式 : \(y\) を \(x_{1},\dotsc,x_{p}\) で説明するための関係式
</p>
<blockquote>
<div>
\begin{equation}
  y=f(x_{1},\dotsc,x_{p})
\end{equation}

</div>
</blockquote></li>
<li><p>
観測データ : n個の \((y,x_{1},\dotsc,x_{p})\) の組
</p>
<blockquote>
<div>
\begin{equation}
  \{(y_i,x_{i1},\dotsc,x_{ip})\}_{i=1}^n
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org6445831">
<h3 id="org6445831">線形回帰</h3>
<ul>
<li>任意の \(f\) では一般的すぎて分析に不向き</li>
<li><p>
\(f\) として <b>1次関数</b> を考える
</p>
<blockquote>
<p>
ある定数 \(\beta_{0},\beta_{1},\dots,\beta_{p}\) を用いた式 :
</p>
<div>
\begin{equation}
  f(x_{1},\dots,x_{p})=\beta_{0}+\beta_{1}x_{1}+\cdots+\beta_{p}x_{p}
\end{equation}

</div>
</blockquote>
<ul>
<li>1次関数の場合 : <b>線形回帰</b> (linear regression)</li>
<li>一般の場合 : 非線形回帰 (nonlinear regression)</li>

</ul></li>
<li>非線形関係は新たな説明変数の導入で対応可能
<ul>
<li>適切な多項式 : \(x_j^2, x_jx_k, x_jx_kx_l,\dotsc\)</li>
<li>その他の非線形変換 : \(\log x_j, x_j^\alpha,\dotsc\)</li>
<li><span style="color:gray;">全ての非線形関係ではない</span></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org7202b9b">
<h3 id="org7202b9b">回帰係数</h3>
<ul>
<li><p>
線形回帰式
</p>
<blockquote>
<div>
\begin{equation}
  y=\beta_{0}+\beta_{1}x_{1}+\cdots+\beta_{p}x_{p}
\end{equation}

</div>
</blockquote>
<ul>
<li>\(\beta_{0},\beta_{1},\dots,\beta_{p}\) : <b>回帰係数</b> (regression coefficients)</li>
<li>\(\beta_{0}\) : <b>定数項 / 切片</b> (constant term / intersection)</li>

</ul></li>
<li><p>
線形回帰分析 (linear regression analysis)
</p>
<blockquote>
<p>
<b>未知の回帰係数をデータから決定する分析方法</b>
</p>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org3bf2194">
<h3 id="org3bf2194">回帰の確率モデル</h3>
<ul>
<li>回帰式の不確定性
<ul>
<li>データは一般に観測誤差などランダムな変動を含む</li>
<li>回帰式がそのまま成立することは期待できない</li>

</ul></li>
<li><p>
確率モデル : データのばらつきを表す項 \(\epsilon_i\) を追加
</p>
<blockquote>
<div>
\begin{equation}
  y_i=\beta_{0}+\beta_{1} x_{i1}+\cdots+\beta_{p}x_{ip}+\epsilon_i\quad (i=1,\dots,n)
\end{equation}

</div>
</blockquote>
<ul>
<li>\(\epsilon_{1},\dots,\epsilon_{n}\) : <b>誤差項 / 撹乱項</b> (error / disturbance term)
<ul>
<li>誤差項は独立な確率変数と仮定</li>
<li>多くの場合，平均0，分散 \(\sigma^2\) の正規分布を仮定</li>

</ul></li>
<li><b>推定</b> (estimation) :
観測データから
\((\beta_{0},\beta_{1},\dots,\beta_{p})\) 
を決定</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-org5d70d97">
<h2 id="org5d70d97">回帰係数の推定</h2>
<div class="outline-text-2" id="text-org5d70d97">
</div>
</section>
<section id="slide-org9eebc89">
<h3 id="org9eebc89">残差</h3>
<ul>
<li><b>残差</b> (residual) :
回帰式で説明できない変動</li>
<li><p>
回帰係数 \(\boldsymbol{\beta}=(\beta_{0},\beta_{1},\dotsc,\beta_{p})^{\mathsf{T}}\) 
を持つ回帰式の残差
</p>
<blockquote>
<div>
\begin{equation}
  e_i(\boldsymbol{\beta})=
  y_i-(\beta_{0}+\beta_{1} x_{i1}+\dotsb+\beta_{p}x_{ip})
  \quad (i=1,\dotsc,n)
\end{equation}

</div>
</blockquote>
<ul>
<li>残差 \(e_i(\boldsymbol{\beta})\) の絶対値が小さいほど当てはまりがよい</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org04c35fc">
<h3 id="org04c35fc">最小二乗法</h3>
<ul>
<li><p>
<b>残差平方和</b> (residual sum of squares)
</p>
<blockquote>
<div>
\begin{equation}
  S(\boldsymbol{\beta})
  =
  \sum_{i=1}^ne_i(\boldsymbol{\beta})^2
\end{equation}

</div>
</blockquote></li>
<li><p>
<b>最小二乗推定量</b> (least squares estimator)
</p>
<blockquote>
<p>
残差平方和
\(S(\boldsymbol{\beta})\)
を最小にする
\(\boldsymbol{\beta}\)
</p>
<div>
\begin{equation}
  \boldsymbol{\hat{\beta}}
  =
  (\hat{\beta}_{0},\hat{\beta}_{1},\dotsc,\hat{\beta}_{p})^{\mathsf{T}}
  =
  \arg\min_{\boldsymbol{\beta}}S(\boldsymbol{\beta})
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgd66cc27">
<h3 id="orgd66cc27">行列の定義</h3>
<ul>
<li><p>
デザイン行列 (design matrix)
</p>
<blockquote>
<div>
\begin{equation}
  X=
  \begin{pmatrix}
    1 & x_{11} & x_{12} & \cdots & x_{1p} \\
    1 & x_{21} & x_{22} & \cdots & x_{2p} \\
    \vdots & \vdots & \vdots & & \vdots \\
    1 & x_{n1} & x_{n2} & \cdots & x_{np}
  \end{pmatrix}
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgdcedd9a">
<h3 id="orgdcedd9a">ベクトルの定義</h3>
<ul>
<li><p>
目的変数，誤差，回帰係数のベクトル
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{y}=
  \begin{pmatrix}
    y_{1} \\
    y_{2} \\
    \vdots \\
    y_{n}
  \end{pmatrix},\quad
  \boldsymbol{\epsilon}=
  \begin{pmatrix}
    \epsilon_{1} \\
    \epsilon_{2} \\
    \vdots \\
    \epsilon_{n}
  \end{pmatrix},\quad
  \boldsymbol{\beta}=
  \begin{pmatrix}
    \beta_{0} \\
    \beta_{1} \\
    \vdots \\
    \beta_{p}
  \end{pmatrix}
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org6e876d3">
<h3 id="org6e876d3">行列・ベクトルによる表現</h3>
<ul>
<li><p>
確率モデル
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{y}
  =X\boldsymbol{\beta}+\boldsymbol{\epsilon}
\end{equation}

</div>
</blockquote></li>
<li><p>
残差平方和
</p>
<blockquote>
<div>
\begin{equation}
  S(\boldsymbol{\beta})
  =(\boldsymbol{y}-X\boldsymbol{\beta})^{\mathsf{T}}
  (\boldsymbol{y}-X\boldsymbol{\beta})
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgabde45b">
<h3 id="orgabde45b">解の条件</h3>
<ul>
<li><p>
解 \(\boldsymbol{\beta}\) では残差平方和の勾配は零ベクトル
</p>

<blockquote>
<div>
\begin{equation}
  \frac{\partial}{\partial\boldsymbol{\beta}}S(\boldsymbol{\beta})
  =
  \Bigl(
  \frac{\partial S}{\partial\beta_{0}}(\boldsymbol{\beta}),
  \frac{\partial S}{\partial\beta_{1}}(\boldsymbol{\beta}),\dotsc,
  \frac{\partial S}{\partial\beta_{p}}(\boldsymbol{\beta})
  \Bigr)^{\mathsf{T}}
  =\boldsymbol{0}
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>

</section>
</section>
<section>
<section id="slide-org67e1158" data-background="#fef4f4">
<h2 id="org67e1158">演習</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgd054c97" data-background="#fef4f4">
<h3 id="orgd054c97">問題</h3>
<ul>
<li>残差平方和
\(S(\boldsymbol{\beta})\)
をベクトル
\(\boldsymbol{\beta}\)
で微分して解の条件を求めなさい</li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgc25d104" data-background="#fef4f4">
<h3 id="orgc25d104">解答例</h3>
<ul>
<li><p>
残差平方和を展開しておく
</p>
<blockquote>
<div>
\begin{align}
  S(\boldsymbol{\beta})
  &=
    (\boldsymbol{y}-X\boldsymbol{\beta})^{\mathsf{T}}
    (\boldsymbol{y}-X\boldsymbol{\beta})\\
  &=
    \boldsymbol{y}^{\mathsf{T}}\boldsymbol{y}
    -\boldsymbol{y}^{\mathsf{T}}X\boldsymbol{\beta}
    -(X\boldsymbol{\beta})^{\mathsf{T}}\boldsymbol{y}
    +(X\boldsymbol{\beta})^{\mathsf{T}}X\boldsymbol{\beta}\\
  &=
    \boldsymbol{y}^{\mathsf{T}}\boldsymbol{y}
    -\boldsymbol{y}^{\mathsf{T}}X\boldsymbol{\beta}
    -\boldsymbol{\beta}^{\mathsf{T}}X^{\mathsf{T}}\boldsymbol{y}
    +\boldsymbol{\beta}^{\mathsf{T}}X^{\mathsf{T}}X\boldsymbol{\beta}\\
\end{align}

</div>
</blockquote></li>
<li><p>
ベクトルによる微分を行うと以下のようになる
</p>
<blockquote>
<div>
\begin{align}
  \frac{\partial}{\partial\boldsymbol{\beta}}S(\boldsymbol{\beta})
  &=
    -(\boldsymbol{y}^{\mathsf{T}}X)^{\mathsf{T}}
    -X^{\mathsf{T}}\boldsymbol{y}
    +(X^{\mathsf{T}}X+(X^{\mathsf{T}}X)^{\mathsf{T}})\boldsymbol{\beta}\\
  &=
    -2X^{\mathsf{T}}\boldsymbol{y}
    +2X^{\mathsf{T}}X\boldsymbol{\beta}
\end{align}

</div>
</blockquote></li>

</ul>


<div class="slide-footer"><br></div>
</section>
<section data-background="#fef4f4">
<ul>
<li><p>
したがって
\(\boldsymbol{\beta}\)
の満たす条件は以下となる
</p>
<blockquote>
<div>
\begin{equation}
  -2X^{\mathsf{T}}\boldsymbol{y}
  +2X^{\mathsf{T}}X\boldsymbol{\beta}
  =0
  \quad\text{ より }
\end{equation}

</div>
<div>
\begin{equation}
  X^{\mathsf{T}}X\boldsymbol{\beta}
  =
  X^{\mathsf{T}}\boldsymbol{y}
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgcadbeab" data-background="#fef4f4">
<h3 id="orgcadbeab">補足</h3>
<ul>
<li><p>
成分ごとの計算は以下のようになる
</p>
<blockquote>
<div>
\begin{equation}
  \frac{\partial S}{\partial\beta_j}(\boldsymbol{\beta})
  =
  -2\sum_{i=1}^n\Bigl(y_i-\sum_{k=0}^p\beta_kx_{ik}\Bigr)x_{ij}
  =0
\end{equation}

</div>

<p>
ただし，
\(x_{i0}=1\; (i=1,\dotsc,n)\),
\(j=0,1,\dotsc,p\)
</p>
<div>
\begin{equation}
  \sum_{i=1}^nx_{ij}\Bigl(\sum_{k=0}^px_{ik}\beta_k\Bigr)
  =
  \sum_{i=1}^nx_{ij}y_i\quad(j=0,1,\dotsc,p)
\end{equation}

</div>

<p>
\(x_{ij}\) は行列 \(X\) の \((i,j)\) 成分であることに注意
</p>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-org7669e1a">
<h2 id="org7669e1a">正規方程式</h2>
<div class="outline-text-2" id="text-org7669e1a">
</div>
</section>
<section id="slide-org18ef582">
<h3 id="org18ef582">正規方程式</h3>
<ul>
<li><p>
<b>正規方程式</b> (normal equation)
</p>
<blockquote>
<div>
\begin{equation}
  X^{\mathsf{T}}X\boldsymbol{\beta}
  =X^{\mathsf{T}}\boldsymbol{y}
\end{equation}

</div>
</blockquote></li>
<li>\(X^{\mathsf{T}}X\) : <b>Gram行列</b> (Gram matrix)
<ul>
<li>\((p+1)\times(p+1)\) 行列 (正方行列)</li>
<li>正定対称行列 (固有値が非負)</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgd72a226">
<h3 id="orgd72a226">正規方程式の解</h3>
<ul>
<li>正規方程式の基本的な性質
<ul>
<li>正規方程式は必ず解をもつ (一意に決まらない場合もある)</li>
<li>正規方程式の解は最小二乗推定量であるための必要条件</li>

</ul></li>
<li>解の一意性の条件
<ul>
<li>Gram 行列 \(X^{\mathsf{T}}X\) が <b>正則</b></li>
<li>\(X\) の列ベクトルが独立 (後述)</li>

</ul></li>
<li><p>
正規方程式の解
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{\hat{\beta}}
  =
  (X^{\mathsf{T}}X)^{-1}X^{\mathsf{T}}\boldsymbol{y}  
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-orgb07d3ed">
<h2 id="orgb07d3ed">最小二乗推定量の性質</h2>
<div class="outline-text-2" id="text-orgb07d3ed">
</div>
</section>
<section id="slide-orgd8e8dea">
<h3 id="orgd8e8dea">解析の上での良い条件</h3>
<ul>
<li><p>
最小二乗推定量がただ一つだけ存在する条件 
</p>
<ul>
<li>\(X^{\mathsf{T}}X\) が正則</li>
<li>\(X^{\mathsf{T}}X\) の階数が \(p{+}1\)</li>
<li>\(X\) の階数が \(p{+}1\)</li>
<li>\(X\) の列ベクトルが <b>1次独立</b></li>

</ul>
<p>
これらは同値条件
</p></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org1d28542">
<h3 id="org1d28542">解析の上での良くない条件</h3>
<ul>
<li>説明変数が1次従属 : <b>多重共線性</b> (multicollinearity)</li>
<li>多重共線性が強くならないように説明変数を選択
<ul>
<li>\(X\) の列(説明変数)の独立性を担保する</li>
<li>説明変数が互いに異なる情報をもつように選ぶ</li>
<li>似た性質をもつ説明変数の重複は避ける</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org7786310">
<h3 id="org7786310">推定の幾何学的解釈</h3>
<ul>
<li><p>
<b>あてはめ値 / 予測値</b> (fitted values / predicted values)
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{\hat{y}}
  =
  X\boldsymbol{\hat{\beta}}
  =
  \hat{\beta}_{0} X_\text{第0列} + 
  \dots + \hat{\beta}_{p} X_\text{第p列}
\end{equation}

</div>
</blockquote></li>

</ul>


<div id="org9b17f12" class="figure">
<p><img src="./figs/projection.png" alt="projection.png" width="60%" />
</p>
<p><span class="figure-number">Figure 1: </span>\(n=3\) , \(p+1=2\) の場合の最小二乗法による推定</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>最小二乗推定量 \(\boldsymbol{\hat{y}}\) の幾何学的性質
<ul>
<li>\(L[X]\): \(X\) の列ベクトルが張る \(\mathbb{R}^n\) の部分線形空間</li>
<li>\(X\) の階数が \(p{+}1\) ならば \(L[X]\) の次元は \(p{+}1\) (解の一意性)</li>
<li>\(\boldsymbol{\hat{y}}\) は \(\boldsymbol{y}\) の \(L[X]\) への直交射影</li>
<li><p>
<b>残差</b> (residuals)
\(\boldsymbol{\hat{\epsilon}}=\boldsymbol{y}-\boldsymbol{\hat{y}}\)
はあてはめ値
\(\boldsymbol{\hat{y}}\) に直交
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{\hat{\epsilon}}\cdot\boldsymbol{\hat{y}}=0
\end{equation}

</div>
</blockquote></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org759e9df">
<h3 id="org759e9df">線形回帰式と標本平均</h3>
<ul>
<li>\(\boldsymbol{x}_i=(x_{i1},\dotsc,x_{ip})^{\mathsf{T}}\):
説明変数の \(i\) 番目の観測データ</li>
<li><p>
説明変数および目的変数の標本平均
</p>
<blockquote>
<div>
\begin{align}
  \boldsymbol{\bar{x}}
  &=\frac{1}{n}\sum_{i=1}^n\boldsymbol{x}_i,
  &\bar{y}
  % \overline{\boldsymbol{x}^2}&=\frac{1}{n}\sum_{i=1}^n\boldsymbol{x}_i\boldsymbol{x}_i^{\mathsf{T}},&
  &=\frac{1}{n}\sum_{i=1}^ny_i,&
  % \overline{\boldsymbol{x}y}&=\frac{1}{n}\sum_{i=1}^n\boldsymbol{x}_iy_i
\end{align}

</div>
</blockquote></li>
<li><p>
\(\boldsymbol{\hat{\beta}}\) が最小二乗推定量のとき以下が成立
</p>
<blockquote>
<div>
\begin{equation}
  \bar{y}
  =
  (1,\boldsymbol{\bar{x}}^{\mathsf{T}})\boldsymbol{\hat{\beta}}
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-org018aa12" data-background="#fef4f4">
<h2 id="org018aa12">演習</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org50b3997" data-background="#fef4f4">
<h3 id="org50b3997">問題</h3>
<ul>
<li>最小二乗推定量について以下を示しなさい
<ul>
<li><p>
残差の標本平均が0となる
</p>
<blockquote>
<p>
以下を示せばよい
</p>
<div>
\begin{equation}
  \boldsymbol{1}^{\mathsf{T}}(\boldsymbol{y}-\boldsymbol{\hat{y}})
  =\boldsymbol{1}^{\mathsf{T}}\boldsymbol{\hat{\epsilon}}
  =0
\end{equation}

</div>

<p>
ただし \(\boldsymbol{1}=(1,\dotsc,1)^{\mathsf{T}}\) とする
</p>
</blockquote></li>
<li><p>
回帰式が標本平均を通る
</p>
<blockquote>
<div>
\begin{equation}
  \bar{y}
  =
  (1,\boldsymbol{\bar{x}}^{\mathsf{T}})\boldsymbol{\hat{\beta}}
\end{equation}

</div>
</blockquote></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgf68dd8c" data-background="#fef4f4">
<h3 id="orgf68dd8c">解答例</h3>
<ul>
<li><p>
残差の表現を整理する
</p>
<blockquote>
<div>
\begin{align}
  \boldsymbol{\hat{\epsilon}}
  &=
    \boldsymbol{y}-\boldsymbol{\hat{y}}
    =
    \boldsymbol{y}-X\boldsymbol{\hat{\beta}}\\
  &=
    \boldsymbol{y}-X(X^{\mathsf{T}}X)^{-1}X^{\mathsf{T}}\boldsymbol{y}
\end{align}

</div>
</blockquote></li>
<li><p>
左から \(X^{\mathsf{T}}\) を乗じる
</p>
<blockquote>
<div>
\begin{equation}
  X^{\mathsf{T}}\boldsymbol{y}-X^{\mathsf{T}}X(X^{\mathsf{T}}X)^{-1}X^{\mathsf{T}}\boldsymbol{y}
  =
  X^{\mathsf{T}}\boldsymbol{y}-X^{\mathsf{T}}\boldsymbol{y}
  =0
\end{equation}

</div>
</blockquote></li>
<li>行列 \(X\) の 1列目が \(\boldsymbol{1}\) であることより明らか</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section data-background="#fef4f4">
<ul>
<li><p>
説明変数の標本平均をデザイン行列で表す
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{1}^{\mathsf{T}}X
  =
  n(1,\boldsymbol{\bar{x}}^{\mathsf{T}})
\end{equation}

</div>
</blockquote></li>
<li><p>
したがって以下が成立する
</p>
<blockquote>
<div>
\begin{align}
  n(1,\boldsymbol{\bar{x}}^{\mathsf{T}})\boldsymbol{\hat{\beta}}
  &=
    \boldsymbol{1}^{\mathsf{T}}X\boldsymbol{\hat{\beta}}\\
  &=
    \boldsymbol{1}^{\mathsf{T}}\boldsymbol{\hat{y}}
    =
    \boldsymbol{1}^{\mathsf{T}}\boldsymbol{y}\\
  &=
    n\bar{y}
\end{align}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-orgdd32668">
<h2 id="orgdd32668">残差の分解</h2>
<div class="outline-text-2" id="text-orgdd32668">
</div>
</section>
<section id="slide-org470d676">
<h3 id="org470d676">最小二乗推定量の残差</h3>
<ul>
<li><p>
観測値と推定値 \(\boldsymbol{\hat{\beta}}\) によるあてはめ値の差
</p>
<blockquote>
<div>
\begin{equation}
  \hat{\epsilon}_i=
  y_i-(\hat{\beta}_{0}+\hat{\beta}_{1} x_{i1}+\dotsb+\hat{\beta}_{p}x_{ip})
  \quad (i=1,\dotsc,n)
\end{equation}

</div>
</blockquote>
<ul>
<li>誤差項 \(\epsilon_{1},\dotsc,\epsilon_{n}\) の推定値</li>
<li>全てができるだけ小さいほど良い</li>
<li>あてはめ値とは独立に偏りがないほど良い</li>

</ul></li>
<li><p>
残差ベクトル
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{\hat{\epsilon}}
  =\boldsymbol{y}-\boldsymbol{\hat{y}}
  =(\hat{\epsilon}_{1},\hat{\epsilon}_{2},\dotsc,\hat{\epsilon}_{n})^{\mathsf{T}}
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org2783630">
<h3 id="org2783630">平方和の分解</h3>
<ul>
<li>\(\bar{\boldsymbol{y}}=\bar{y}\boldsymbol{1}=(\bar{y},\bar{y},\dotsc,\bar{y})^{\mathsf{T}}\) :
標本平均のベクトル</li>
<li>いろいろなばらつき
<ul>
<li>\(S_y=(\boldsymbol{y}-\bar{\boldsymbol{y}})^{\mathsf{T}}
    (\boldsymbol{y}-\bar{\boldsymbol{y}})\) :
目的変数のばらつき</li>
<li>\(S_{\phantom{y}}=(\boldsymbol{y}-\boldsymbol{\hat{y}})^{\mathsf{T}}
    (\boldsymbol{y}-\boldsymbol{\hat{y}})\) :
残差のばらつき
(\(\boldsymbol{\hat{\epsilon}}^{\mathsf{T}}\boldsymbol{\hat{\epsilon}}\))</li>
<li>\(S_r=(\boldsymbol{\hat{y}}-\bar{\boldsymbol{y}})^{\mathsf{T}}
    (\boldsymbol{\hat{y}}-\bar{\boldsymbol{y}})\) :
あてはめ値(回帰)のばらつき</li>

</ul></li>
<li><p>
3つのばらつき(平方和)の関係
</p>
<blockquote>
<div>
\begin{equation}
  (\boldsymbol{y}-\bar{\boldsymbol{y}})^{\mathsf{T}}
  (\boldsymbol{y}-\bar{\boldsymbol{y}})
  =
  (\boldsymbol{y}-\boldsymbol{\hat{y}})^{\mathsf{T}}
  (\boldsymbol{y}-\boldsymbol{\hat{y}})+ 
  (\boldsymbol{\hat{y}}-\bar{\boldsymbol{y}})^{\mathsf{T}}
  (\boldsymbol{\hat{y}}-\bar{\boldsymbol{y}})
\end{equation}

</div>
<div>
\begin{equation}
  S_y=S+S_r
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-orgc25676f" data-background="#fef4f4">
<h2 id="orgc25676f">演習</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org9ef94e8" data-background="#fef4f4">
<h3 id="org9ef94e8">問題</h3>
<ul>
<li>以下の関係式を示しなさい
<ul>
<li><p>
あてはめ値と残差のベクトルが直交する
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{\hat{y}}^{\mathsf{T}}(\boldsymbol{y}-\boldsymbol{\hat{y}})
  = 
  \boldsymbol{\hat{y}}^{\mathsf{T}}\boldsymbol{\hat{\epsilon}}
  =0
\end{equation}

</div>
</blockquote></li>
<li><p>
残差平方和の分解が成り立つ
</p>
<blockquote>
<div>
\begin{equation}
  S_y=S+S_r
\end{equation}

</div>
</blockquote></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org8d9c4d1" data-background="#fef4f4">
<h3 id="org8d9c4d1">解答例</h3>
<ul>
<li><p>
残差の表現を整理する
</p>
<blockquote>
<div>
\begin{align}
  \boldsymbol{\hat{\epsilon}}
  &=
    \boldsymbol{y}-X(X^{\mathsf{T}}X)^{-1}X^{\mathsf{T}}\boldsymbol{y}\\
  &=
    (I-X(X^{\mathsf{T}}X)^{-1}X^{\mathsf{T}})\boldsymbol{y}
\end{align}

</div>
</blockquote></li>
<li><p>
左から \(\boldsymbol{\hat{y}}\) を乗じる
</p>
<blockquote>
<div>
\begin{align}
  \boldsymbol{\hat{y}}^{\mathsf{T}}\boldsymbol{\hat{\epsilon}}
  &=
    \boldsymbol{\hat{\beta}}^{\mathsf{T}}X^{\mathsf{T}}
    (I-X(X^{\mathsf{T}}X)^{-1}X^{\mathsf{T}})\boldsymbol{y}\\
  &=
    \boldsymbol{\hat{\beta}}^{\mathsf{T}}
    (X^{\mathsf{T}}-X^{\mathsf{T}}X(X^{\mathsf{T}}X)^{-1}X^{\mathsf{T}})\boldsymbol{y}\\
  &=
    \boldsymbol{\hat{\beta}}^{\mathsf{T}}
    (X^{\mathsf{T}}-X^{\mathsf{T}})\boldsymbol{y}=0
\end{align}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section data-background="#fef4f4">
<ul>
<li><p>
以下の関係を用いて展開すればよい
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{y}-\bar{\boldsymbol{y}}
  =\boldsymbol{y}-\boldsymbol{\hat{y}}+\boldsymbol{\hat{y}}-\bar{\boldsymbol{y}}
\end{equation}

</div>

<p>
ただし \(\bar{\boldsymbol{y}}=\bar{y}\boldsymbol{1}\) 
</p>
</blockquote></li>
<li><p>
このとき以下の項は0になる
</p>
<blockquote>
<div>
\begin{equation}
  (\boldsymbol{\hat{y}}-\bar{\boldsymbol{y}})^{\mathsf{T}}
  (\boldsymbol{y}-\boldsymbol{\hat{y}})
  =
  \boldsymbol{\hat{y}}^{\mathsf{T}}
  (\boldsymbol{y}-\boldsymbol{\hat{y}})
  -
  \bar{y}\boldsymbol{1}^{\mathsf{T}}
  (\boldsymbol{y}-\boldsymbol{\hat{y}})
  =0
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-org80bfc2f">
<h2 id="org80bfc2f">決定係数</h2>
<div class="outline-text-2" id="text-org80bfc2f">
</div>
</section>
<section id="slide-org2ea6ff1">
<h3 id="org2ea6ff1">回帰式の寄与</h3>
<ul>
<li><p>
ばらつきの分解
</p>
<blockquote>
<div>
\begin{equation}
  S_y\;\text{(目的変数)} =S\;\text{(残差)} +S_r\;\text{(あてはめ値)}
\end{equation}

</div>
</blockquote></li>
<li><p>
回帰式で説明できるばらつきの比率
</p>
<blockquote>
<div>
\begin{equation}
  \text{(回帰式の寄与率)}
  = \frac{S_{r}}{S_{y}}
  = 1-\frac{S}{S_{y}}
\end{equation}

</div>
</blockquote></li>
<li>回帰式のあてはまり具合を評価する代表的な指標</li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgc312d84">
<h3 id="orgc312d84">決定係数 (\(R^2\)値)</h3>
<ul>
<li><p>
<b>決定係数</b> (R-squared)
</p>
<blockquote>
<div>
\begin{equation}
  R^2
  =
  1-\frac{\sum_{i=1}^n\hat{\epsilon}_i^2}{\sum_{i=1}^n(y_i-\bar{y})^2}
\end{equation}

</div>
</blockquote></li>
<li><p>
<b>自由度調整済み決定係数</b> (adjusted R-squared)
</p>
<blockquote>
<div>
\begin{equation}
  \bar{R}^2
  =
  1-\frac{\frac{1}{n{-}p{-}1}\sum_{i=1}^n\hat{\epsilon}_i^2}
  {\frac{1}{n{-}1}\sum_{i=1}^n(y_i-\bar{y})^2}
\end{equation}

</div>
</blockquote>
<ul>
<li>不偏分散で補正している</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-org7491e36">
<h2 id="org7491e36">解析の事例</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org391248a">
<h3 id="org391248a">データについて</h3>
<ul>
<li>気象庁より取得した東京の気候データ <br />
<ul>
<li>気象庁 <a href="https://www.data.jma.go.jp/gmd/risk/obsdl/index.php">https://www.data.jma.go.jp/gmd/risk/obsdl/index.php</a></li>
<li>データ <a href="https://noboru-murata.github.io/multivariate-analysis/data/tokyo_weather.csv">https://noboru-murata.github.io/multivariate-analysis/data/tokyo_weather.csv</a></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orga711084">
<h3 id="orga711084">東京の8月の気候の分析</h3>
<ul>
<li><p>
気候 (気温,降雨,日射,降雪,風向,風速,気圧,湿度,雲量) <br />
に関するデータ(の一部)
</p>
<pre class="example" id="orga30bace">
    month day day_of_week temp rain solar snow wdir wind  press humid cloud
213     8   1         Sun 28.7  0.0 26.58    0  SSE  3.2 1000.2    76   2.3
214     8   2         Mon 28.6  0.5 19.95    0   SE  3.4 1006.1    80   7.0
215     8   3         Tue 29.0  3.0 19.89    0    S  4.0 1009.9    80   6.3
216     8   4         Wed 29.5  0.0 26.52    0    S  3.0 1008.2    76   2.8
217     8   5         Thu 29.1  0.0 26.17    0  SSE  2.8 1005.1    74   5.8
218     8   6         Fri 29.1  0.0 24.82    0  SSE  2.9 1004.2    75   4.0
219     8   7         Sat 27.9  2.0 11.43    0   NE  2.5 1003.1    85   9.0
220     8   8         Sun 25.9 90.5  3.43    0    N  3.0  998.0    97  10.0
221     8   9         Mon 28.1  2.0 13.34    0    S  6.1  995.4    84   6.0
222     8  10         Tue 31.0  0.0 22.45    0  SSW  4.7  996.3    58   4.8
223     8  11         Wed 29.2  0.0 21.12    0   SE  2.9 1008.0    61   9.3
224     8  12         Thu 26.0  0.5  8.34    0  SSE  2.4 1008.8    84   9.5
225     8  13         Fri 22.5 20.5  4.36    0   NE  2.7 1008.0    97  10.0
226     8  14         Sat 22.3 77.0  2.76    0    N  2.7 1003.6   100  10.0
</pre></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
関連するデータの散布図
</p></li>

</ul>


<div id="orgcade75c" class="figure">
<p><img src="figs/03_pairs.png" alt="03_pairs.png" />
</p>
<p><span class="figure-number">Figure 2: </span>散布図</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>気温を説明する 5 つの線形回帰モデルを検討する
<ul>
<li>モデル1 : 気温 = F(気圧)</li>
<li>モデル2 : 気温 = F(日射)</li>
<li>モデル3 : 気温 = F(気圧, 日射)</li>
<li>モデル4 : 気温 = F(気圧, 日射, 湿度)</li>
<li>モデル5 : 気温 = F(気圧, 日射, 雲量)</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
モデル1の推定結果
</p></li>

</ul>


<div id="org1b97c61" class="figure">
<p><img src="figs/03_model1.png" alt="03_model1.png" />
</p>
<p><span class="figure-number">Figure 3: </span>モデル1</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
モデル2の推定結果
</p></li>

</ul>


<div id="org6f42ac9" class="figure">
<p><img src="figs/03_model2.png" alt="03_model2.png" />
</p>
<p><span class="figure-number">Figure 4: </span>モデル2</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
モデル3の推定結果
</p></li>

</ul>


<div id="org12905c7" class="figure">
<p><img src="figs/03_model3.png" alt="03_model3.png" />
</p>
<p><span class="figure-number">Figure 5: </span>モデル3</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
観測値とあてはめ値の比較
</p></li>

</ul>


<div id="org5ac4940" class="figure">
<p><img src="figs/03_models.png" alt="03_models.png" />
</p>
<p><span class="figure-number">Figure 6: </span>モデルの比較</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>決定係数・自由度調整済み決定係数
<ul>
<li><p>
モデル1 : 気温 = F(気圧)
</p>
<pre class="example">
[1] "R2: 0.0483 ; adj. R2: 0.0155"
</pre></li>

<li><p>
モデル2 : 気温 = F(日射)
</p>
<pre class="example">
[1] "R2: 0.663 ; adj. R2: 0.651"
</pre></li>

<li><p>
モデル3 : 気温 = F(気圧, 日射)
</p>
<pre class="example">
[1] "R2: 0.703 ; adj. R2: 0.681"
</pre></li>

<li><p>
モデル4 : 気温 = F(気圧, 日射, 湿度)
</p>
<pre class="example">
[1] "R2: 0.83 ; adj. R2: 0.811"
</pre></li>

<li><p>
モデル5 : 気温 = F(気圧, 日射, 雲量)
</p>
<pre class="example">
[1] "R2: 0.703 ; adj. R2: 0.67"
</pre></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-orgb84ed36">
<h2 id="orgb84ed36">次回の予定</h2>
<ul>
<li>第1回: 回帰モデルの考え方と推定</li>
<li><b>第2回: モデルの評価</b></li>
<li>第3回: モデルによる予測と発展的なモデル</li>

</ul>
<div class="slide-footer"><br></div>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>
<script src="./reveal.js/plugin/search/search.js"></script>
<script src="./reveal.js/plugin/zoom/zoom.js"></script>
<script src="./reveal.js/plugin/highlight/highlight.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: true,
hashOneBasedIndex: false,
pdfSeparateFragments: false,
overview: true,

transition: 'fade',
transitionSpeed: 'default',
spotlight: { size: 90, initialPresentationMode: false }, chalkboard: { toggleChalkboardButton: { left: '80px' }, toggleNotesButton: { left: '130px'}}, keyboard: { 69: function() { RevealChalkboard.toggleNotesCanvas() }, 87: function() { RevealChalkboard.toggleChalkboard() }, 67: function() { RevealChalkboard.clear() }, 82: function() { RevealChalkboard.reset() }, 68: function() { RevealChalkboard.download() }, 88: function() { RevealChalkboard.colorNext() }, 89: function() { RevealChalkboard.colorPrev() }, 84: function() { RevealSpotlight.toggleSpotlight() }, 81: function() { RevealSpotlight.togglePresentationMode()}},

// Plugins with reveal.js 4.x
plugins: [ RevealNotes, RevealSearch, RevealZoom, RevealHighlight ],

// Optional libraries used to extend reveal.js
dependencies: [
{ src: './reveal.js/plugin/menu/menu.js'},
{ src: './reveal.js/plugin/chalkboard/chalkboard.js'},
{ src: './reveal.js/plugin/spotlight/spotlight.js'}]

});
</script>
</body>
</html>
